<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta charset="utf-8" />
    <meta name="generator" content="quarto-1.5.56" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=yes"
    />
    <meta name="author" content="Teng Kok Wai (Walter)" />
    <meta name="dcterms.date" content="2024-08-24" />
    <title>
      1B: Thematic Mapping and GeoVisualisation with R – Walter Teng’s
      Coursework for SMU ISSS626: Geospatial Analytics and Applications
    </title>
    <style>
      code {
        white-space: pre-wrap;
      }
      span.smallcaps {
        font-variant: small-caps;
      }
      div.columns {
        display: flex;
        gap: min(4vw, 1.5em);
      }
      div.column {
        flex: auto;
        overflow-x: auto;
      }
      div.hanging-indent {
        margin-left: 1.5em;
        text-indent: -1.5em;
      }
      ul.task-list {
        list-style: none;
      }
      ul.task-list li input[type="checkbox"] {
        width: 0.8em;
        margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */
        vertical-align: middle;
      }
      /* CSS for syntax highlighting */
      pre > code.sourceCode {
        white-space: pre;
        position: relative;
      }
      pre > code.sourceCode > span {
        line-height: 1.25;
      }
      pre > code.sourceCode > span:empty {
        height: 1.2em;
      }
      .sourceCode {
        overflow: visible;
      }
      code.sourceCode > span {
        color: inherit;
        text-decoration: inherit;
      }
      div.sourceCode {
        margin: 1em 0;
      }
      pre.sourceCode {
        margin: 0;
      }
      @media screen {
        div.sourceCode {
          overflow: auto;
        }
      }
      @media print {
        pre > code.sourceCode {
          white-space: pre-wrap;
        }
        pre > code.sourceCode > span {
          display: inline-block;
          text-indent: -5em;
          padding-left: 5em;
        }
      }
      pre.numberSource code {
        counter-reset: source-line 0;
      }
      pre.numberSource code > span {
        position: relative;
        left: -4em;
        counter-increment: source-line;
      }
      pre.numberSource code > span > a:first-child::before {
        content: counter(source-line);
        position: relative;
        left: -1em;
        text-align: right;
        vertical-align: baseline;
        border: none;
        display: inline-block;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        padding: 0 4px;
        width: 4em;
      }
      pre.numberSource {
        margin-left: 3em;
        padding-left: 4px;
      }
      div.sourceCode {
      }
      @media screen {
        pre > code.sourceCode > span > a:first-child::before {
          text-decoration: underline;
        }
      }
    </style>

    <script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
    <script src="../../site_libs/quarto-nav/headroom.min.js"></script>
    <script src="../../site_libs/clipboard/clipboard.min.js"></script>
    <script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
    <script src="../../site_libs/quarto-search/fuse.min.js"></script>
    <script src="../../site_libs/quarto-search/quarto-search.js"></script>
    <meta name="quarto:offset" content="../../" />
    <link href="../../favicon.ico" rel="icon" />
    <script src="../../site_libs/quarto-html/quarto.js"></script>
    <script src="../../site_libs/quarto-html/popper.min.js"></script>
    <script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
    <script src="../../site_libs/quarto-html/anchor.min.js"></script>
    <link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet" />
    <link
      href="../../site_libs/quarto-html/quarto-syntax-highlighting.css"
      rel="stylesheet"
      class="quarto-color-scheme"
      id="quarto-text-highlighting-styles"
    />
    <link
      href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css"
      rel="stylesheet"
      class="quarto-color-scheme quarto-color-alternate"
      id="quarto-text-highlighting-styles"
    />
    <script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
    <link
      href="../../site_libs/bootstrap/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link
      href="../../site_libs/bootstrap/bootstrap.min.css"
      rel="stylesheet"
      class="quarto-color-scheme"
      id="quarto-bootstrap"
      data-mode="light"
    />
    <link
      href="../../site_libs/bootstrap/bootstrap-dark.min.css"
      rel="stylesheet"
      class="quarto-color-scheme quarto-color-alternate"
      id="quarto-bootstrap"
      data-mode="dark"
    />
    <link
      href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css"
      rel="stylesheet"
    />
    <link
      href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css"
      rel="stylesheet"
    />
    <script id="quarto-search-options" type="application/json">
      {
        "location": "navbar",
        "copy-button": false,
        "collapse-after": 3,
        "panel-placement": "end",
        "type": "overlay",
        "limit": 50,
        "keyboard-shortcut": ["f", "/", "s"],
        "show-item-context": false,
        "language": {
          "search-no-results-text": "No results",
          "search-matching-documents-text": "matching documents",
          "search-copy-link-title": "Copy link to search",
          "search-hide-matches-text": "Hide additional matches",
          "search-more-match-text": "more match in this document",
          "search-more-matches-text": "more matches in this document",
          "search-clear-button-title": "Clear",
          "search-text-placeholder": "",
          "search-detached-cancel-button-title": "Cancel",
          "search-submit-button-title": "Submit",
          "search-label": "Search"
        }
      }
    </script>
    <script
      async=""
      src="https://www.googletagmanager.com/gtag/js?id=G-4MGB7PXBSL"
    ></script>
    <script type="text/javascript">
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-4MGB7PXBSL", { anonymize_ip: true });
    </script>
    <link rel="stylesheet" href="../../styles.css" />
    <meta
      property="og:title"
      content="1B: Thematic Mapping and GeoVisualisation with R – Walter Teng’s Coursework for SMU ISSS626: Geospatial Analytics and Applications"
    />
    <meta
      property="og:description"
      content="In this exercise, we will learn to create thematic maps and perform geovisualization in R using the tmap package, including data preparation, classification, color schemes, and advanced mapping techniques."
    />
    <meta
      property="og:image"
      content="https://isss626-gaa.netlify.app/Hands-on_Ex/Hands-on_Ex01/og-img.png"
    />
    <meta
      property="og:site_name"
      content="Walter Teng's Coursework for SMU ISSS626: Geospatial Analytics and Applications"
    />
    <meta
      name="twitter:title"
      content="1B: Thematic Mapping and GeoVisualisation with R – Walter Teng’s Coursework for SMU ISSS626: Geospatial Analytics and Applications"
    />
    <meta
      name="twitter:description"
      content="In this exercise, we will learn to create thematic maps and perform geovisualization in R using the tmap package, including data preparation, classification, color schemes, and advanced mapping techniques."
    />
    <meta
      name="twitter:image"
      content="https://isss626-gaa.netlify.app/Hands-on_Ex/Hands-on_Ex01/og-img.png"
    />
    <meta name="twitter:creator" content="@davzoku" />
    <meta name="twitter:site" content="@davzoku" />
    <meta name="twitter:card" content="summary_large_image" />
  </head>
  <body class="nav-fixed">
    <div id="quarto-search-results"></div>
    <header id="quarto-header" class="headroom fixed-top">
      <nav class="navbar navbar-expand-lg" data-bs-theme="dark">
        <div class="navbar-container container-fluid">
          <div class="navbar-brand-container mx-auto">
            <a class="navbar-brand" href="../../index.html">
              <span class="navbar-title"
                >ISSS626 Geospatial Analytics and Applications</span
              >
            </a>
          </div>
          <div id="quarto-search" class="" title="Search"></div>
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarCollapse"
            aria-controls="navbarCollapse"
            role="menu"
            aria-expanded="false"
            aria-label="Toggle navigation"
            onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
              <li class="nav-item dropdown">
                <a
                  class="nav-link dropdown-toggle"
                  href="#"
                  id="nav-menu-hands-on-exercises"
                  role="link"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                >
                  <span class="menu-text">Hands-on Exercises</span>
                </a>
                <ul
                  class="dropdown-menu"
                  aria-labelledby="nav-menu-hands-on-exercises"
                >
                  <li>
                    <a
                      class="dropdown-item"
                      href="../../Hands-on_Ex/Hands-on_Ex01/Hands-on_Ex01a.html"
                    >
                      <span class="dropdown-text"
                        >1A: Geospatial Data Wrangling with R</span
                      ></a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item"
                      href="../../Hands-on_Ex/Hands-on_Ex01/Hands-on_Ex01b.html"
                    >
                      <span class="dropdown-text"
                        >1B: Choropleth Mapping with R</span
                      ></a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item"
                      href="../../Hands-on_Ex/Hands-on_Ex02/Hands-on_Ex02a.html"
                    >
                      <span class="dropdown-text"
                        >2A: 1st Order Spatial Point Patterns Analysis</span
                      ></a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item"
                      href="../../Hands-on_Ex/Hands-on_Ex02/Hands-on_Ex02b.html"
                    >
                      <span class="dropdown-text"
                        >2B: 2nd Order Spatial Point Patterns Analysis</span
                      ></a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item"
                      href="../../Hands-on_Ex/Hands-on_Ex03/Hands-on_Ex03a.html"
                    >
                      <span class="dropdown-text"
                        >3A: Network Constrained Spatial Point Patterns
                        Analysis</span
                      ></a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item"
                      href="../../Hands-on_Ex/Hands-on_Ex04/Hands-on_Ex04a.html"
                    >
                      <span class="dropdown-text"
                        >4A: Spatial Weights and Applications</span
                      ></a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item"
                      href="../../Hands-on_Ex/Hands-on_Ex05/Hands-on_Ex05a.html"
                    >
                      <span class="dropdown-text"
                        >5A: Global Measures of Spatial Autocorrelation</span
                      ></a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item"
                      href="../../Hands-on_Ex/Hands-on_Ex05/Hands-on_Ex05b.html"
                    >
                      <span class="dropdown-text"
                        >5B: Local Measures of Spatial Autocorrelation</span
                      ></a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item"
                      href="../../Hands-on_Ex/Hands-on_Ex06/Hands-on_Ex06a.html"
                    >
                      <span class="dropdown-text"
                        >6A: Geographical Segmentation with Spatially
                        Constrained Clustering Techniques</span
                      ></a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item"
                      href="../../Hands-on_Ex/Hands-on_Ex07/Hands-on_Ex07a.html"
                    >
                      <span class="dropdown-text"
                        >7A: Calibrating Hedonic Pricing Model for Private
                        Highrise Property with GWR Method</span
                      ></a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item"
                      href="../../Hands-on_Ex/Hands-on_Ex08/Hands-on_Ex08a.html"
                    >
                      <span class="dropdown-text"
                        >8A: Geographically Weighted Predictive Models</span
                      ></a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item"
                      href="../../Hands-on_Ex/Hands-on_Ex09/Hands-on_Ex09a.html"
                    >
                      <span class="dropdown-text"
                        >9A: Modelling Geographical Accessibility</span
                      ></a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item"
                      href="../../Hands-on_Ex/Hands-on_Ex10/Hands-on_Ex10a.html"
                    >
                      <span class="dropdown-text"
                        >10A: Processing and Visualising Flow Data</span
                      ></a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item"
                      href="../../Hands-on_Ex/Hands-on_Ex10/Hands-on_Ex10b.html"
                    >
                      <span class="dropdown-text"
                        >10B: Calibrating Spatial Interaction Models with
                        R</span
                      ></a
                    >
                  </li>
                </ul>
              </li>
              <li class="nav-item dropdown">
                <a
                  class="nav-link dropdown-toggle"
                  href="#"
                  id="nav-menu-in-class-exercises"
                  role="link"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                >
                  <span class="menu-text">In-class Exercises</span>
                </a>
                <ul
                  class="dropdown-menu"
                  aria-labelledby="nav-menu-in-class-exercises"
                >
                  <li>
                    <a
                      class="dropdown-item"
                      href="../../In-class_Ex/In-class_Ex01/In-class_Ex01.html"
                    >
                      <span class="dropdown-text">In-class Exercise 01</span></a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item"
                      href="../../In-class_Ex/In-class_Ex02/In-class_Ex02.html"
                    >
                      <span class="dropdown-text">In-class Exercise 02</span></a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item"
                      href="../../In-class_Ex/In-class_Ex03/In-class_Ex03.html"
                    >
                      <span class="dropdown-text">In-class Exercise 03</span></a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item"
                      href="../../In-class_Ex/In-class_Ex04/In-class_Ex04.html"
                    >
                      <span class="dropdown-text">In-class Exercise 04</span></a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item"
                      href="../../In-class_Ex/In-class_Ex05/In-class_Ex05.html"
                    >
                      <span class="dropdown-text">In-class Exercise 05</span></a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item"
                      href="../../In-class_Ex/In-class_Ex06/In-class_Ex06.html"
                    >
                      <span class="dropdown-text">In-class Exercise 06</span></a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item"
                      href="../../In-class_Ex/In-class_Ex07/In-class_Ex07.html"
                    >
                      <span class="dropdown-text">In-class Exercise 07</span></a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item"
                      href="../../In-class_Ex/In-class_Ex08/In-class_Ex08.html"
                    >
                      <span class="dropdown-text">In-class Exercise 08</span></a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item"
                      href="../../In-class_Ex/In-class_Ex09/In-class_Ex09.html"
                    >
                      <span class="dropdown-text">In-class Exercise 09</span></a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item"
                      href="../../In-class_Ex/In-class_Ex10/In-class_Ex10.html"
                    >
                      <span class="dropdown-text">In-class Exercise 10</span></a
                    >
                  </li>
                </ul>
              </li>
              <li class="nav-item dropdown">
                <a
                  class="nav-link dropdown-toggle"
                  href="#"
                  id="nav-menu-take-home-exercises"
                  role="link"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                >
                  <span class="menu-text">Take-home Exercises</span>
                </a>
                <ul
                  class="dropdown-menu"
                  aria-labelledby="nav-menu-take-home-exercises"
                >
                  <li>
                    <a
                      class="dropdown-item"
                      href="../../Take-home_Ex/Take-home_Ex01/Take-home_Ex01.html"
                    >
                      <span class="dropdown-text"
                        >Take-home Exercise 01</span
                      ></a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item"
                      href="../../Take-home_Ex/Take-home_Ex02/Take-home_Ex02.html"
                    >
                      <span class="dropdown-text"
                        >Take-home Exercise 02</span
                      ></a
                    >
                  </li>
                  <li>
                    <a
                      class="dropdown-item"
                      href="../../Take-home_Ex/Take-home_Ex03/Take-home_Ex03.html"
                    >
                      <span class="dropdown-text"
                        >Take-home Exercise 03</span
                      ></a
                    >
                  </li>
                </ul>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="../../Exploration/index.html">
                  <span class="menu-text">Exploration</span></a
                >
              </li>
            </ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
              <li class="nav-item">
                <a class="nav-link" href="../../index.html">
                  <span class="menu-text"
                    ><i
                      class="fa-solid fa-house fa-md"
                      aria-label="house"
                    ></i></span
                ></a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="https://www.walterteng.com">
                  <span class="menu-text"
                    ><i
                      class="fa-solid fa-user fa-md"
                      aria-label="user"
                    ></i></span
                ></a>
              </li>
              <li class="nav-item compact">
                <a
                  class="nav-link"
                  href="https://www.linkedin.com/in/tengkokwai/"
                >
                  <i class="bi bi-linkedin" role="img"> </i>
                  <span class="menu-text"></span
                ></a>
              </li>
              <li class="nav-item compact">
                <a
                  class="nav-link"
                  href="https://github.com/davzoku/isss626-gaa"
                >
                  <i class="bi bi-github" role="img"> </i>
                  <span class="menu-text"></span
                ></a>
              </li>
            </ul>
          </div>
          <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
            <a
              href=""
              class="quarto-color-scheme-toggle quarto-navigation-tool px-1"
              onclick="window.quartoToggleColorScheme(); return false;"
              title="Toggle dark mode"
              ><i class="bi"></i
            ></a>
          </div>
        </div>
        <!-- /container-fluid -->
      </nav>
    </header>
    <!-- content -->
    <div
      id="quarto-content"
      class="quarto-container page-columns page-rows-contents page-layout-article page-navbar"
    >
      <!-- sidebar -->
      <!-- margin-sidebar -->
      <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
          <h2 id="toc-title">On this page</h2>

          <ul>
            <li>
              <a
                href="#exercise-1b-reference"
                id="toc-exercise-1b-reference"
                class="nav-link active"
                data-scroll-target="#exercise-1b-reference"
                ><span class="header-section-number">1</span> Exercise 1B
                Reference</a
              >
            </li>
            <li>
              <a
                href="#overview"
                id="toc-overview"
                class="nav-link"
                data-scroll-target="#overview"
                ><span class="header-section-number">2</span> Overview</a
              >
            </li>
            <li>
              <a
                href="#learning-outcome"
                id="toc-learning-outcome"
                class="nav-link"
                data-scroll-target="#learning-outcome"
                ><span class="header-section-number">3</span> Learning
                Outcome</a
              >
            </li>
            <li>
              <a
                href="#the-data"
                id="toc-the-data"
                class="nav-link"
                data-scroll-target="#the-data"
                ><span class="header-section-number">4</span> The Data</a
              >
            </li>
            <li>
              <a
                href="#installing-and-loading-the-r-packages"
                id="toc-installing-and-loading-the-r-packages"
                class="nav-link"
                data-scroll-target="#installing-and-loading-the-r-packages"
                ><span class="header-section-number">5</span> Installing and
                Loading the R Packages</a
              >
            </li>
            <li>
              <a
                href="#import-geospatial-data-into-r"
                id="toc-import-geospatial-data-into-r"
                class="nav-link"
                data-scroll-target="#import-geospatial-data-into-r"
                ><span class="header-section-number">6</span> Import Geospatial
                Data into R</a
              >
              <ul class="collapse">
                <li>
                  <a
                    href="#importing-attribute-data-into-r"
                    id="toc-importing-attribute-data-into-r"
                    class="nav-link"
                    data-scroll-target="#importing-attribute-data-into-r"
                    ><span class="header-section-number">6.1</span> Importing
                    Attribute Data into R</a
                  >
                </li>
                <li>
                  <a
                    href="#data-preparation"
                    id="toc-data-preparation"
                    class="nav-link"
                    data-scroll-target="#data-preparation"
                    ><span class="header-section-number">6.2</span> Data
                    Preparation</a
                  >
                </li>
              </ul>
            </li>
            <li>
              <a
                href="#choropleth-mapping-geospatial-data-using-tmap"
                id="toc-choropleth-mapping-geospatial-data-using-tmap"
                class="nav-link"
                data-scroll-target="#choropleth-mapping-geospatial-data-using-tmap"
                ><span class="header-section-number">7</span> Choropleth Mapping
                Geospatial Data Using <em>tmap</em></a
              >
              <ul class="collapse">
                <li>
                  <a
                    href="#plotting-a-choropleth-map-quickly-by-using-qtm"
                    id="toc-plotting-a-choropleth-map-quickly-by-using-qtm"
                    class="nav-link"
                    data-scroll-target="#plotting-a-choropleth-map-quickly-by-using-qtm"
                    ><span class="header-section-number">7.1</span> Plotting a
                    choropleth map quickly by using <em>qtm()</em></a
                  >
                </li>
                <li>
                  <a
                    href="#creating-a-choropleth-map-by-using-tmaps-elements"
                    id="toc-creating-a-choropleth-map-by-using-tmaps-elements"
                    class="nav-link"
                    data-scroll-target="#creating-a-choropleth-map-by-using-tmaps-elements"
                    ><span class="header-section-number">7.2</span> Creating a
                    choropleth map by using <em>tmap</em>’s elements</a
                  >
                </li>
                <li>
                  <a
                    href="#data-classification-methods-of-tmap"
                    id="toc-data-classification-methods-of-tmap"
                    class="nav-link"
                    data-scroll-target="#data-classification-methods-of-tmap"
                    ><span class="header-section-number">7.3</span> Data
                    classification methods of <strong>tmap</strong></a
                  >
                </li>
                <li>
                  <a
                    href="#colour-scheme"
                    id="toc-colour-scheme"
                    class="nav-link"
                    data-scroll-target="#colour-scheme"
                    ><span class="header-section-number">7.4</span> Colour
                    Scheme</a
                  >
                </li>
                <li>
                  <a
                    href="#map-layouts"
                    id="toc-map-layouts"
                    class="nav-link"
                    data-scroll-target="#map-layouts"
                    ><span class="header-section-number">7.5</span> Map
                    Layouts</a
                  >
                </li>
                <li>
                  <a
                    href="#drawing-small-multiple-choropleth-maps"
                    id="toc-drawing-small-multiple-choropleth-maps"
                    class="nav-link"
                    data-scroll-target="#drawing-small-multiple-choropleth-maps"
                    ><span class="header-section-number">7.6</span> Drawing
                    Small Multiple Choropleth Maps</a
                  >
                </li>
                <li>
                  <a
                    href="#mapping-spatial-object-by-meeting-a-selection-criterion"
                    id="toc-mapping-spatial-object-by-meeting-a-selection-criterion"
                    class="nav-link"
                    data-scroll-target="#mapping-spatial-object-by-meeting-a-selection-criterion"
                    ><span class="header-section-number">7.7</span> Mapping
                    Spatial Object by Meeting a Selection Criterion</a
                  >
                </li>
              </ul>
            </li>
            <li>
              <a
                href="#references"
                id="toc-references"
                class="nav-link"
                data-scroll-target="#references"
                ><span class="header-section-number">8</span> References</a
              >
              <ul class="collapse">
                <li>
                  <a
                    href="#all-about-tmap-package"
                    id="toc-all-about-tmap-package"
                    class="nav-link"
                    data-scroll-target="#all-about-tmap-package"
                    ><span class="header-section-number">8.1</span> All about
                    <strong>tmap</strong> package</a
                  >
                </li>
                <li>
                  <a
                    href="#geospatial-data-wrangling"
                    id="toc-geospatial-data-wrangling"
                    class="nav-link"
                    data-scroll-target="#geospatial-data-wrangling"
                    ><span class="header-section-number">8.2</span> Geospatial
                    Data Wrangling</a
                  >
                </li>
                <li>
                  <a
                    href="#data-wrangling-1"
                    id="toc-data-wrangling-1"
                    class="nav-link"
                    data-scroll-target="#data-wrangling-1"
                    ><span class="header-section-number">8.3</span> Data
                    Wrangling</a
                  >
                </li>
              </ul>
            </li>
          </ul>
        </nav>
      </div>
      <!-- main -->
      <main class="content" id="quarto-document-content">
        <header id="title-block-header" class="quarto-title-block default">
          <div class="quarto-title">
            <h1 class="title">
              1B: Thematic Mapping and GeoVisualisation with R
            </h1>
            <p class="subtitle lead">
              In this exercise, we will learn to create thematic maps and
              perform geovisualization in R using the tmap package, including
              data preparation, classification, color schemes, and advanced
              mapping techniques.
            </p>
          </div>

          <div class="quarto-title-meta">
            <div>
              <div class="quarto-title-meta-heading">Author</div>
              <div class="quarto-title-meta-contents">
                <p>Teng Kok Wai (Walter)</p>
              </div>
            </div>

            <div>
              <div class="quarto-title-meta-heading">Published</div>
              <div class="quarto-title-meta-contents">
                <p class="date">August 24, 2024</p>
              </div>
            </div>

            <div>
              <div class="quarto-title-meta-heading">Modified</div>
              <div class="quarto-title-meta-contents">
                <p class="date-modified">September 27, 2024</p>
              </div>
            </div>
          </div>
        </header>
        <section id="exercise-1b-reference" class="level2" data-number="1">
          <h2
            data-number="1"
            class="anchored"
            data-anchor-id="exercise-1b-reference"
          >
            <span class="header-section-number">1</span> Exercise 1B Reference
          </h2>
          <p>
            <a href="https://r4gdsa.netlify.app/chap02.html"
              >R for Geospatial Data Science and Analytics - 2&nbsp; Thematic
              Mapping and GeoVisualisation with R</a
            >
          </p>
        </section>
        <section id="overview" class="level2" data-number="2">
          <h2 data-number="2" class="anchored" data-anchor-id="overview">
            <span class="header-section-number">2</span> Overview
          </h2>
          <p>
            In general, thematic mapping involves the use of map symbols to
            visualize selected properties of geographic features that are not
            naturally visible, such as population, temperature, crime rate, and
            property prices.
          </p>
          <p>
            Meanwhile, geovisualization leverages graphical representation to
            make places, phenomena, or processes visible, tapping into our
            spatial cognition and visual processing abilities.
          </p>
        </section>
        <section id="learning-outcome" class="level2" data-number="3">
          <h2
            data-number="3"
            class="anchored"
            data-anchor-id="learning-outcome"
          >
            <span class="header-section-number">3</span> Learning Outcome
          </h2>
          <ul>
            <li>
              Understanding thematic mapping and geovisualization concepts.
            </li>
            <li>
              Installing and using the <code>tmap</code> package for creating
              choropleth maps.
            </li>
            <li>
              Importing and preparing geospatial and attribute data using
              <code>sf</code> and <code>readr</code> packages.
            </li>
            <li>
              Wrangling data with <code>dplyr</code> and <code>tidyr</code> to
              prepare for mapping.
            </li>
            <li>
              Performing georelational joins between geospatial and attribute
              data.
            </li>
            <li>
              Creating quick and advanced thematic maps using
              <code>tmap</code> elements and functions.
            </li>
            <li>
              Customizing map layouts, color schemes, and data classification
              methods.
            </li>
            <li>
              Plotting small multiple maps and mapping spatial objects meeting
              specific criteria.
            </li>
          </ul>
        </section>
        <section id="the-data" class="level2" data-number="4">
          <h2 data-number="4" class="anchored" data-anchor-id="the-data">
            <span class="header-section-number">4</span> The Data
          </h2>
          <p>The following data sources will be used in this exercise:</p>
          <table class="caption-top table">
            <thead>
              <tr class="header">
                <th>Dataset</th>
                <th>Source</th>
                <th>Description</th>
                <th>Format</th>
              </tr>
            </thead>
            <tbody>
              <tr class="odd">
                <td>
                  <strong
                    >Master Plan 2014 Subzone Boundary (Web)
                    (<code>MP14_SUBZONE_WEB_PL</code>)</strong
                  >
                </td>
                <td><a href="https://www.data.gov.sg/">data.gov.sg</a></td>
                <td>
                  Geospatial data representing the geographical boundaries of
                  Singapore’s planning subzones based on URA Master Plan 2014.
                </td>
                <td>ESRI Shapefile</td>
              </tr>
              <tr class="even">
                <td>
                  <strong
                    >Singapore Residents by Planning Area / Subzone, Age Group,
                    Sex, and Type of Dwelling (2011-2020)
                    (<code>respopagesextod2011to2020.csv</code>)</strong
                  >
                </td>
                <td>
                  <a href="https://www.singstat.gov.sg/"
                    >Department of Statistics, Singapore</a
                  >
                </td>
                <td>
                  Aspatial data containing demographic information; fields
                  <code>PA</code> and <code>SZ</code> can be used to link to the
                  <code>MP14_SUBZONE_WEB_PL</code> shapefile.
                </td>
                <td>CSV</td>
              </tr>
            </tbody>
          </table>
          <p>
            This table summarizes the datasets required, including their
            descriptions, sources, and formats.
          </p>
        </section>
        <section
          id="installing-and-loading-the-r-packages"
          class="level2"
          data-number="5"
        >
          <h2
            data-number="5"
            class="anchored"
            data-anchor-id="installing-and-loading-the-r-packages"
          >
            <span class="header-section-number">5</span> Installing and Loading
            the R Packages
          </h2>
          <p>The following R packages will be used in this exercise:</p>
          <table class="caption-top table">
            <colgroup>
              <col style="width: 8%" />
              <col style="width: 49%" />
              <col style="width: 41%" />
            </colgroup>
            <thead>
              <tr class="header">
                <th>Package</th>
                <th>Purpose</th>
                <th>Use Case in Exercise</th>
              </tr>
            </thead>
            <tbody>
              <tr class="odd">
                <td><strong>tmap</strong></td>
                <td>Thematic mapping for visualizing geospatial data.</td>
                <td>Creating and customizing thematic maps.</td>
              </tr>
              <tr class="even">
                <td><strong>sf</strong></td>
                <td>Handling geospatial data in simple features format.</td>
                <td>Importing, managing, and processing geospatial data.</td>
              </tr>
              <tr class="odd">
                <td><strong>readr</strong></td>
                <td>
                  Importing delimited text files (part of
                  <code>tidyverse</code>).
                </td>
                <td>Loading CSV data files.</td>
              </tr>
              <tr class="even">
                <td><strong>tidyr</strong></td>
                <td>
                  Tidying data into a usable format (part of
                  <code>tidyverse</code>).
                </td>
                <td>Reshaping and organizing data.</td>
              </tr>
              <tr class="odd">
                <td><strong>dplyr</strong></td>
                <td>
                  Data wrangling and transformation tasks (part of
                  <code>tidyverse</code>).
                </td>
                <td>Manipulating and transforming datasets.</td>
              </tr>
            </tbody>
          </table>
          <p>
            To install and load these packages in R, use the following code:
          </p>
          <div class="cell">
            <div class="sourceCode" id="cb1">
              <pre
                class="downlit sourceCode r code-with-copy"
              ><code class="sourceCode R"><span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html">p_load</a></span><span class="op">(</span><span class="va">sf</span>, <span class="va">tmap</span>, <span class="va">tidyverse</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
            </div>
          </div>
        </section>
        <section
          id="import-geospatial-data-into-r"
          class="level2"
          data-number="6"
        >
          <h2
            data-number="6"
            class="anchored"
            data-anchor-id="import-geospatial-data-into-r"
          >
            <span class="header-section-number">6</span> Import Geospatial Data
            into R
          </h2>
          <p>
            The code block below uses st_read() function of sf package to import
            the <code>MP14_SUBZONE_WEB_PL</code> shapefile into R as a polygon
            feature data frame.
          </p>
          <div class="cell">
            <div class="sourceCode" id="cb2">
              <pre
                class="downlit sourceCode r code-with-copy"
              ><code class="sourceCode R"><span><span class="va">mpsz</span> <span class="op">=</span> <span class="fu">st_read</span><span class="op">(</span>dsn <span class="op">=</span> <span class="st">"data/geospatial"</span>,</span>
<span>                  layer <span class="op">=</span> <span class="st">"MP14_SUBZONE_WEB_PL"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
            </div>
            <div class="cell-output cell-output-stdout">
              <pre><code>Reading layer `MP14_SUBZONE_WEB_PL' from data source
  `/Users/walter/code/isss626/isss626-gaa/Hands-on_Ex/Hands-on_Ex01/data/geospatial'
  using driver `ESRI Shapefile'
Simple feature collection with 323 features and 15 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 2667.538 ymin: 15748.72 xmax: 56396.44 ymax: 50256.33
Projected CRS: SVY21</code></pre>
            </div>
          </div>
          <p>
            When you display mpsz, only the first ten records are shown because
            R, by default, limits the number of printed rows to make output more
            manageable and readable.
          </p>
          <div class="cell">
            <div class="sourceCode" id="cb4">
              <pre
                class="downlit sourceCode r code-with-copy"
              ><code class="sourceCode R"><span><span class="va">mpsz</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
            </div>
            <div class="cell-output cell-output-stdout">
              <pre><code>Simple feature collection with 323 features and 15 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 2667.538 ymin: 15748.72 xmax: 56396.44 ymax: 50256.33
Projected CRS: SVY21
First 10 features:
   OBJECTID SUBZONE_NO       SUBZONE_N SUBZONE_C CA_IND      PLN_AREA_N
1         1          1    MARINA SOUTH    MSSZ01      Y    MARINA SOUTH
2         2          1    PEARL'S HILL    OTSZ01      Y          OUTRAM
3         3          3       BOAT QUAY    SRSZ03      Y SINGAPORE RIVER
4         4          8  HENDERSON HILL    BMSZ08      N     BUKIT MERAH
5         5          3         REDHILL    BMSZ03      N     BUKIT MERAH
6         6          7  ALEXANDRA HILL    BMSZ07      N     BUKIT MERAH
7         7          9   BUKIT HO SWEE    BMSZ09      N     BUKIT MERAH
8         8          2     CLARKE QUAY    SRSZ02      Y SINGAPORE RIVER
9         9         13 PASIR PANJANG 1    QTSZ13      N      QUEENSTOWN
10       10          7       QUEENSWAY    QTSZ07      N      QUEENSTOWN
   PLN_AREA_C       REGION_N REGION_C          INC_CRC FMEL_UPD_D   X_ADDR
1          MS CENTRAL REGION       CR 5ED7EB253F99252E 2014-12-05 31595.84
2          OT CENTRAL REGION       CR 8C7149B9EB32EEFC 2014-12-05 28679.06
3          SR CENTRAL REGION       CR C35FEFF02B13E0E5 2014-12-05 29654.96
4          BM CENTRAL REGION       CR 3775D82C5DDBEFBD 2014-12-05 26782.83
5          BM CENTRAL REGION       CR 85D9ABEF0A40678F 2014-12-05 26201.96
6          BM CENTRAL REGION       CR 9D286521EF5E3B59 2014-12-05 25358.82
7          BM CENTRAL REGION       CR 7839A8577144EFE2 2014-12-05 27680.06
8          SR CENTRAL REGION       CR 48661DC0FBA09F7A 2014-12-05 29253.21
9          QT CENTRAL REGION       CR 1F721290C421BFAB 2014-12-05 22077.34
10         QT CENTRAL REGION       CR 3580D2AFFBEE914C 2014-12-05 24168.31
     Y_ADDR SHAPE_Leng SHAPE_Area                       geometry
1  29220.19   5267.381  1630379.3 MULTIPOLYGON (((31495.56 30...
2  29782.05   3506.107   559816.2 MULTIPOLYGON (((29092.28 30...
3  29974.66   1740.926   160807.5 MULTIPOLYGON (((29932.33 29...
4  29933.77   3313.625   595428.9 MULTIPOLYGON (((27131.28 30...
5  30005.70   2825.594   387429.4 MULTIPOLYGON (((26451.03 30...
6  29991.38   4428.913  1030378.8 MULTIPOLYGON (((25899.7 297...
7  30230.86   3275.312   551732.0 MULTIPOLYGON (((27746.95 30...
8  30222.86   2208.619   290184.7 MULTIPOLYGON (((29351.26 29...
9  29893.78   6571.323  1084792.3 MULTIPOLYGON (((20996.49 30...
10 30104.18   3454.239   631644.3 MULTIPOLYGON (((24472.11 29...</code></pre>
            </div>
          </div>
          <section
            id="importing-attribute-data-into-r"
            class="level3"
            data-number="6.1"
          >
            <h3
              data-number="6.1"
              class="anchored"
              data-anchor-id="importing-attribute-data-into-r"
            >
              <span class="header-section-number">6.1</span> Importing Attribute
              Data into R
            </h3>
            <p>
              Next, <em>respopagsex2011to2020.csv</em> file is imported into
              RStudio and save the file into an R dataframe called
              <em>popdata</em>.
            </p>
            <p>
              The task will be performed by using <em>read_csv()</em> function
              of <strong>readr</strong> package as shown in the code block
              below.
            </p>
            <div class="cell">
              <div class="sourceCode" id="cb6">
                <pre
                  class="downlit sourceCode r code-with-copy"
                ><code class="sourceCode R"><span><span class="va">popdata</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/aspatial/respopagesextod2011to2020.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
              </div>
            </div>
          </section>
          <section id="data-preparation" class="level3" data-number="6.2">
            <h3
              data-number="6.2"
              class="anchored"
              data-anchor-id="data-preparation"
            >
              <span class="header-section-number">6.2</span> Data Preparation
            </h3>
            <p>
              Before a thematic map can be prepared, it is required to prepare a
              data table with year 2020 values. The data table should include
              the variables PA, SZ, YOUNG, ECONOMY ACTIVE, AGED, TOTAL,
              DEPENDENCY.
            </p>
            <ul>
              <li>YOUNG: age group 0 to 4 until age groyup 20 to 24,</li>
              <li>ECONOMY ACTIVE: age group 25-29 until age group 60-64,</li>
              <li>AGED: age group 65 and above,</li>
              <li>TOTAL: all age group, and</li>
              <li>
                DEPENDENCY: the ratio between young and aged against economy
                active group
              </li>
            </ul>
            <section id="data-wrangling" class="level4" data-number="6.2.1">
              <h4
                data-number="6.2.1"
                class="anchored"
                data-anchor-id="data-wrangling"
              >
                <span class="header-section-number">6.2.1</span> Data wrangling
              </h4>
              <p>
                The following data wrangling and transformation functions will
                be used:
              </p>
              <ul>
                <li>
                  <em>pivot_wider()</em> of <strong>tidyr</strong> package, and
                </li>
                <li>
                  <em>mutate()</em>, <em>filter()</em>, <em>group_by()</em> and
                  <em>select()</em> of <strong>dplyr</strong> package
                </li>
              </ul>
              <div class="cell">
                <div class="sourceCode" id="cb7">
                  <pre
                    class="downlit sourceCode r code-with-copy"
                  ><code class="sourceCode R"><span><span class="co"># Step 1: Filter the data for the year 2020</span></span>
<span><span class="va">popdata2020</span> <span class="op">&lt;-</span> <span class="va">popdata</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">Time</span> <span class="op">==</span> <span class="fl">2020</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 2: Group the data by PA (Planning Area), SZ (Subzone), and AG (Age Group)</span></span>
<span><span class="va">popdata2020</span> <span class="op">&lt;-</span> <span class="va">popdata2020</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">PA</span>, <span class="va">SZ</span>, <span class="va">AG</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 3: Summarize the data by calculating the total population (POP) for each group</span></span>
<span><span class="va">popdata2020</span> <span class="op">&lt;-</span> <span class="va">popdata2020</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>POP <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">Pop</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 4: Reshape the data from long to wide format, with age groups as column names</span></span>
<span><span class="va">popdata2020</span> <span class="op">&lt;-</span> <span class="va">popdata2020</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">AG</span>, values_from <span class="op">=</span> <span class="va">POP</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 5: Calculate the YOUNG population (sum of selected age groups)</span></span>
<span><span class="va">popdata2020</span> <span class="op">&lt;-</span> <span class="va">popdata2020</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>YOUNG <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">.</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">.</span><span class="op">[</span><span class="fl">14</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 6: Calculate the ECONOMICALLY ACTIVE population (sum of selected age groups)</span></span>
<span><span class="va">popdata2020</span> <span class="op">&lt;-</span> <span class="va">popdata2020</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>`ECONOMY ACTIVE` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">.</span><span class="op">[</span><span class="fl">7</span><span class="op">:</span><span class="fl">11</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">.</span><span class="op">[</span><span class="fl">13</span><span class="op">:</span><span class="fl">15</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 7: Calculate the AGED population (sum of selected age groups)</span></span>
<span><span class="va">popdata2020</span> <span class="op">&lt;-</span> <span class="va">popdata2020</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>AGED <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">.</span><span class="op">[</span><span class="fl">16</span><span class="op">:</span><span class="fl">21</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 8: Calculate the TOTAL population (sum of all age groups)</span></span>
<span><span class="va">popdata2020</span> <span class="op">&lt;-</span> <span class="va">popdata2020</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>TOTAL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">.</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">21</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 9: Calculate the DEPENDENCY ratio (ratio of YOUNG and AGED to ECONOMY ACTIVE)</span></span>
<span><span class="va">popdata2020</span> <span class="op">&lt;-</span> <span class="va">popdata2020</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>DEPENDENCY <span class="op">=</span> <span class="op">(</span><span class="va">YOUNG</span> <span class="op">+</span> <span class="va">AGED</span><span class="op">)</span> <span class="op">/</span> <span class="va">`ECONOMY ACTIVE`</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Step 10: Select the relevant columns to be retained in the final dataset</span></span>
<span><span class="va">popdata2020</span> <span class="op">&lt;-</span> <span class="va">popdata2020</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">PA</span>, <span class="va">SZ</span>, <span class="va">YOUNG</span>, <span class="va">`ECONOMY ACTIVE`</span>, <span class="va">AGED</span>, <span class="va">TOTAL</span>, <span class="va">DEPENDENCY</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
                </div>
              </div>
            </section>
            <section
              id="joining-the-attribute-data-and-geospatial-data"
              class="level4"
              data-number="6.2.2"
            >
              <h4
                data-number="6.2.2"
                class="anchored"
                data-anchor-id="joining-the-attribute-data-and-geospatial-data"
              >
                <span class="header-section-number">6.2.2</span> Joining the
                attribute data and geospatial data
              </h4>
              <p>
                Before performing a georelational join, one additional step is
                necessary: converting the values in the PA and SZ fields to
                uppercase. This is because the PA and SZ fields contain both
                upper- and lowercase letters, whereas the SUBZONE_N and
                PLN_AREA_N fields are in uppercase.
              </p>
              <div class="cell">
                <div class="sourceCode" id="cb8">
                  <pre
                    class="downlit sourceCode r code-with-copy"
                  ><code class="sourceCode R"><span><span class="va">popdata2020</span> <span class="op">&lt;-</span> <span class="va">popdata2020</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate_at</span><span class="op">(</span>.vars <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">PA</span>, <span class="va">SZ</span><span class="op">)</span>,</span>
<span>          .funs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">toupper</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">`ECONOMY ACTIVE`</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
                </div>
              </div>
              <p>
                Next, the left_join() function from the dplyr package is used to
                merge the geographic data and attribute table, using the
                planning subzone names (e.g.&nbsp;SUBZONE_N and SZ) as the
                common identifier.
              </p>
              <div class="cell">
                <div class="sourceCode" id="cb9">
                  <pre
                    class="downlit sourceCode r code-with-copy"
                  ><code class="sourceCode R"><span><span class="va">mpsz_pop2020</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">mpsz</span>, <span class="va">popdata2020</span>,</span>
<span>                          by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SUBZONE_N"</span> <span class="op">=</span> <span class="st">"SZ"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
                </div>
              </div>
              <div
                class="callout callout-style-default callout-note callout-titled"
              >
                <div class="callout-header d-flex align-content-center">
                  <div class="callout-icon-container">
                    <i class="callout-icon"></i>
                  </div>
                  <div class="callout-title-container flex-fill">Note</div>
                </div>
                <div class="callout-body-container callout-body">
                  <p><strong>Key Takeaway:</strong></p>
                  <p>
                    The left_join() function from the dplyr package is applied
                    to ensure that the resulting output remains a simple
                    features data frame, with mpsz as the left table.
                  </p>
                </div>
              </div>
              <div class="cell">
                <div class="sourceCode" id="cb10">
                  <pre
                    class="downlit sourceCode r code-with-copy"
                  ><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="st">"data/rds/"</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">write_rds</span><span class="op">(</span><span class="va">mpsz_pop2020</span>, <span class="st">"data/rds/mpszpop2020.rds"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
                </div>
              </div>
            </section>
          </section>
        </section>
        <section
          id="choropleth-mapping-geospatial-data-using-tmap"
          class="level2"
          data-number="7"
        >
          <h2
            data-number="7"
            class="anchored"
            data-anchor-id="choropleth-mapping-geospatial-data-using-tmap"
          >
            <span class="header-section-number">7</span> Choropleth Mapping
            Geospatial Data Using <em>tmap</em>
          </h2>
          <p>
            Choropleth mapping involves the symbolisation of enumeration units,
            such as countries, provinces, states, counties or census units,
            using area patterns or graduated colors. For example, a social
            scientist may need to use a choropleth map to portray the spatial
            distribution of aged population of Singapore by Master Plan 2014
            Subzone Boundary.
          </p>
          <p>There are two methods for creating thematic maps using tmap:</p>
          <ul>
            <li>Using <code>qtm()</code> for quick thematic map plotting.</li>
            <li>
              Using individual tmap elements for creating highly customizable
              maps.
            </li>
          </ul>
          <section
            id="plotting-a-choropleth-map-quickly-by-using-qtm"
            class="level3"
            data-number="7.1"
          >
            <h3
              data-number="7.1"
              class="anchored"
              data-anchor-id="plotting-a-choropleth-map-quickly-by-using-qtm"
            >
              <span class="header-section-number">7.1</span> Plotting a
              choropleth map quickly by using <em>qtm()</em>
            </h3>
            <p>
              The easiest and quickest to draw a choropleth map using
              <strong>tmap</strong> is using <em>qtm()</em>. It is concise and
              provides a good default visualisation in many cases.
            </p>
            <p>The following code draws a standard choropleth map:</p>
            <div class="cell">
              <div class="sourceCode" id="cb11">
                <pre
                  class="downlit sourceCode r code-with-copy"
                ><code class="sourceCode R"><span><span class="fu">tmap_mode</span><span class="op">(</span><span class="st">"plot"</span><span class="op">)</span></span>
<span><span class="fu">qtm</span><span class="op">(</span><span class="va">mpsz_pop2020</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"DEPENDENCY"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
              </div>
              <div class="cell-output-display">
                <div>
                  <figure class="figure">
                    <p>
                      <img
                        src="Hands-on_Ex01b_files/figure-html/unnamed-chunk-9-1.png"
                        class="img-fluid figure-img"
                        width="672"
                      />
                    </p>
                  </figure>
                </div>
              </div>
            </div>
            <div
              class="callout callout-style-default callout-note callout-titled"
            >
              <div class="callout-header d-flex align-content-center">
                <div class="callout-icon-container">
                  <i class="callout-icon"></i>
                </div>
                <div class="callout-title-container flex-fill">Note</div>
              </div>
              <div class="callout-body-container callout-body">
                <p><strong>Key Takeaway:</strong></p>
                <ul>
                  <li>
                    tmap_mode(“plot”) is used to generate a static map. To
                    enable interactive mode, use the “view” option.
                  </li>
                  <li>
                    The fill argument is used to map the attribute to be
                    visualized (in this case, DEPENDENCY).
                  </li>
                </ul>
              </div>
            </div>
          </section>
          <section
            id="creating-a-choropleth-map-by-using-tmaps-elements"
            class="level3"
            data-number="7.2"
          >
            <h3
              data-number="7.2"
              class="anchored"
              data-anchor-id="creating-a-choropleth-map-by-using-tmaps-elements"
            >
              <span class="header-section-number">7.2</span> Creating a
              choropleth map by using <em>tmap</em>’s elements
            </h3>
            <p>
              While <code>qtm()</code> is useful for quickly and easily drawing
              choropleth maps, its drawback is the limited control over the
              aesthetics of individual layers. To create a high-quality,
              cartographic choropleth map like the one shown below, it’s
              recommended to use the individual elements provided by
              <em>tmap</em>.
            </p>
            <div class="cell">
              <div class="sourceCode" id="cb12">
                <pre
                  class="downlit sourceCode r code-with-copy"
                ><code class="sourceCode R"><span><span class="fu">tm_shape</span><span class="op">(</span><span class="va">mpsz_pop2020</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_fill</span><span class="op">(</span><span class="st">"DEPENDENCY"</span>,</span>
<span>          style <span class="op">=</span> <span class="st">"quantile"</span>,</span>
<span>          palette <span class="op">=</span> <span class="st">"Blues"</span>,</span>
<span>          title <span class="op">=</span> <span class="st">"Dependency ratio"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_layout</span><span class="op">(</span>main.title <span class="op">=</span> <span class="st">"Distribution of Dependency Ratio by planning subzone"</span>,</span>
<span>            main.title.position <span class="op">=</span> <span class="st">"center"</span>,</span>
<span>            main.title.size <span class="op">=</span> <span class="fl">1.2</span>,</span>
<span>            legend.height <span class="op">=</span> <span class="fl">0.45</span>,</span>
<span>            legend.width <span class="op">=</span> <span class="fl">0.35</span>,</span>
<span>            frame <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_borders</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_compass</span><span class="op">(</span>type<span class="op">=</span><span class="st">"8star"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_scale_bar</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_grid</span><span class="op">(</span>alpha <span class="op">=</span><span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_credits</span><span class="op">(</span><span class="st">"Source: Planning Sub-zone boundary from Urban Redevelopment Authorithy (URA)\n and Population data from Department of Statistics DOS"</span>,</span>
<span>             position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"bottom"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
              </div>
              <div class="cell-output-display">
                <div>
                  <figure class="figure">
                    <p>
                      <img
                        src="Hands-on_Ex01b_files/figure-html/unnamed-chunk-10-1.png"
                        class="img-fluid figure-img"
                        width="672"
                      />
                    </p>
                  </figure>
                </div>
              </div>
            </div>
            <p>
              In the following sub-section, more <em>tmap</em> functions will be
              used to plot these elements.
            </p>
            <section id="drawing-a-base-map" class="level4" data-number="7.2.1">
              <h4
                data-number="7.2.1"
                class="anchored"
                data-anchor-id="drawing-a-base-map"
              >
                <span class="header-section-number">7.2.1</span> Drawing a base
                map
              </h4>
              <p>
                The basic building block of <strong>tmap</strong> is
                <em>tm_shape()</em> followed by one or more layer elemments such
                as <em>tm_fill()</em> and <em>tm_polygons()</em>.
              </p>
              <p>
                In the code block below, <em>tm_shape()</em> is used to define
                the input data (i.e <em>mpsz_pop2020</em>) and
                <em>tm_polygons()</em> is used to draw the planning subzone
                polygons
              </p>
              <div class="cell">
                <div class="sourceCode" id="cb13">
                  <pre
                    class="downlit sourceCode r code-with-copy"
                  ><code class="sourceCode R"><span><span class="fu">tm_shape</span><span class="op">(</span><span class="va">mpsz_pop2020</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_polygons</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
                </div>
                <div class="cell-output-display">
                  <div>
                    <figure class="figure">
                      <p>
                        <img
                          src="Hands-on_Ex01b_files/figure-html/unnamed-chunk-11-1.png"
                          class="img-fluid figure-img"
                          width="672"
                        />
                      </p>
                    </figure>
                  </div>
                </div>
              </div>
            </section>
            <section
              id="drawing-a-choropleth-map-using-tm_polygons"
              class="level4"
              data-number="7.2.2"
            >
              <h4
                data-number="7.2.2"
                class="anchored"
                data-anchor-id="drawing-a-choropleth-map-using-tm_polygons"
              >
                <span class="header-section-number">7.2.2</span> Drawing a
                choropleth map using <em>tm_polygons()</em>
              </h4>
              <p>
                To draw a choropleth map showing the geographical distribution
                of a selected variable by planning subzone, we just need to
                assign the target variable such as <em>Dependency</em> to
                <em>tm_polygons()</em>.
              </p>
              <div class="cell">
                <div class="sourceCode" id="cb14">
                  <pre
                    class="downlit sourceCode r code-with-copy"
                  ><code class="sourceCode R"><span><span class="fu">tm_shape</span><span class="op">(</span><span class="va">mpsz_pop2020</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_polygons</span><span class="op">(</span><span class="st">"DEPENDENCY"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
                </div>
                <div class="cell-output-display">
                  <div>
                    <figure class="figure">
                      <p>
                        <img
                          src="Hands-on_Ex01b_files/figure-html/unnamed-chunk-12-1.png"
                          class="img-fluid figure-img"
                          width="672"
                        />
                      </p>
                    </figure>
                  </div>
                </div>
              </div>
              <div
                class="callout callout-style-default callout-note callout-titled"
              >
                <div class="callout-header d-flex align-content-center">
                  <div class="callout-icon-container">
                    <i class="callout-icon"></i>
                  </div>
                  <div class="callout-title-container flex-fill">Note</div>
                </div>
                <div class="callout-body-container callout-body">
                  <p>Key takeaways from <em>tm_polygons()</em>:</p>
                  <ul>
                    <li>
                      The default method for interval binning when creating a
                      choropleth map is “pretty.” A detailed explanation of the
                      data classification methods available in
                      <strong>tmap</strong> will be covered in sub-section 4.3.
                    </li>
                    <li>
                      The default color palette used is <code>YlOrRd</code> from
                      ColorBrewer. More information on color schemes will be
                      explored in sub-section 4.4.
                    </li>
                    <li>
                      Missing values are automatically represented with a grey
                      shade by default.
                    </li>
                  </ul>
                </div>
              </div>
            </section>
            <section
              id="drawing-a-choropleth-map-using-tm_fill-and-tm_border"
              class="level4"
              data-number="7.2.3"
            >
              <h4
                data-number="7.2.3"
                class="anchored"
                data-anchor-id="drawing-a-choropleth-map-using-tm_fill-and-tm_border"
              >
                <span class="header-section-number">7.2.3</span> Drawing a
                choropleth map using <em>tm_fill()</em> and *tm_border()**
              </h4>
              <p>
                Actually, <em>tm_polygons()</em> is a wraper of
                <em>tm_fill()</em> and <em>tm_border()</em>.
                <em>tm_fill()</em> shades the polygons by using the default
                colour scheme and <em>tm_borders()</em> adds the borders of the
                shapefile onto the choropleth map.
              </p>
              <p>
                The code block below draws a choropleth map by using
                <em>tm_fill()</em> alone.
              </p>
              <div class="cell">
                <div class="sourceCode" id="cb15">
                  <pre
                    class="downlit sourceCode r code-with-copy"
                  ><code class="sourceCode R"><span><span class="fu">tm_shape</span><span class="op">(</span><span class="va">mpsz_pop2020</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_fill</span><span class="op">(</span><span class="st">"DEPENDENCY"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
                </div>
                <div class="cell-output-display">
                  <div>
                    <figure class="figure">
                      <p>
                        <img
                          src="Hands-on_Ex01b_files/figure-html/unnamed-chunk-13-1.png"
                          class="img-fluid figure-img"
                          width="672"
                        />
                      </p>
                    </figure>
                  </div>
                </div>
              </div>
              <p>
                Notice that the planning subzones are shared according to the
                respective dependecy values
              </p>
              <p>
                To add the boundary of the planning subzones, tm_borders will be
                used as shown in the code block below.
              </p>
              <div class="cell">
                <div class="sourceCode" id="cb16">
                  <pre
                    class="downlit sourceCode r code-with-copy"
                  ><code class="sourceCode R"><span><span class="fu">tm_shape</span><span class="op">(</span><span class="va">mpsz_pop2020</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_fill</span><span class="op">(</span><span class="st">"DEPENDENCY"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_borders</span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">0.1</span>,  alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
                </div>
                <div class="cell-output-display">
                  <div>
                    <figure class="figure">
                      <p>
                        <img
                          src="Hands-on_Ex01b_files/figure-html/unnamed-chunk-14-1.png"
                          class="img-fluid figure-img"
                          width="672"
                        />
                      </p>
                    </figure>
                  </div>
                </div>
              </div>
              <p>
                Note that light-gray border lines have been added on the
                choropleth map.
              </p>
              <p>
                The <em>alpha</em> option specifies a transparency value ranging
                from 0 (completely transparent) to 1 (not transparent). By
                default, the col’s alpha value is used (usually 1).
              </p>
              <p>
                Beside <em>alpha</em> argument, there are three other arguments
                for <em>tm_borders()</em>, they are:
              </p>
              <ul>
                <li><em>col</em> = border colour,</li>
                <li><em>lwd</em> = border line width. The default is 1, and</li>
                <li>
                  <em>lty</em> = border line type. The default is “solid”.
                </li>
              </ul>
            </section>
          </section>
          <section
            id="data-classification-methods-of-tmap"
            class="level3"
            data-number="7.3"
          >
            <h3
              data-number="7.3"
              class="anchored"
              data-anchor-id="data-classification-methods-of-tmap"
            >
              <span class="header-section-number">7.3</span> Data classification
              methods of <strong>tmap</strong>
            </h3>
            <p>
              Most choropleth maps employ some methods of data classification.
              The point of classification is to take a large number of
              observations and group them into data ranges or classes.
            </p>
            <p>
              <strong>tmap</strong> provides a total ten data classification
              methods, namely: <em>fixed</em>, <em>sd</em>, <em>equal</em>,
              <em>pretty</em> (default), <em>quantile</em>, <em>kmeans</em>,
              <em>hclust</em>, <em>bclust</em>, <em>fisher</em>, and
              <em>jenks</em>.
            </p>
            <p>
              To define a data classification method, the
              <em>style</em> argument of <em>tm_fill()</em> or
              <em>tm_polygons()</em> will be used.
            </p>
            <section
              id="plotting-choropleth-maps-with-built-in-classification-methods"
              class="level4"
              data-number="7.3.1"
            >
              <h4
                data-number="7.3.1"
                class="anchored"
                data-anchor-id="plotting-choropleth-maps-with-built-in-classification-methods"
              >
                <span class="header-section-number">7.3.1</span> Plotting
                choropleth maps with built-in classification methods
              </h4>
              <p>
                The code block below shows a quantile data classification that
                used 5 classes.
              </p>
              <div class="cell">
                <div class="sourceCode" id="cb17">
                  <pre
                    class="downlit sourceCode r code-with-copy"
                  ><code class="sourceCode R"><span><span class="fu">tm_shape</span><span class="op">(</span><span class="va">mpsz_pop2020</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_fill</span><span class="op">(</span><span class="st">"DEPENDENCY"</span>,</span>
<span>          n <span class="op">=</span> <span class="fl">5</span>,</span>
<span>          style <span class="op">=</span> <span class="st">"quantile"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_borders</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
                </div>
                <div class="cell-output-display">
                  <div>
                    <figure class="figure">
                      <p>
                        <img
                          src="Hands-on_Ex01b_files/figure-html/unnamed-chunk-15-1.png"
                          class="img-fluid figure-img"
                          width="672"
                        />
                      </p>
                    </figure>
                  </div>
                </div>
              </div>
              <p>
                In the code block below, <em>equal</em> data classification
                method is used.
              </p>
              <div class="cell">
                <div class="sourceCode" id="cb18">
                  <pre
                    class="downlit sourceCode r code-with-copy"
                  ><code class="sourceCode R"><span><span class="fu">tm_shape</span><span class="op">(</span><span class="va">mpsz_pop2020</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_fill</span><span class="op">(</span><span class="st">"DEPENDENCY"</span>,</span>
<span>          n <span class="op">=</span> <span class="fl">5</span>,</span>
<span>          style <span class="op">=</span> <span class="st">"equal"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_borders</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
                </div>
                <div class="cell-output-display">
                  <div>
                    <figure class="figure">
                      <p>
                        <img
                          src="Hands-on_Ex01b_files/figure-html/unnamed-chunk-16-1.png"
                          class="img-fluid figure-img"
                          width="672"
                        />
                      </p>
                    </figure>
                  </div>
                </div>
              </div>
              <div
                class="callout callout-style-default callout-note callout-titled"
              >
                <div class="callout-header d-flex align-content-center">
                  <div class="callout-icon-container">
                    <i class="callout-icon"></i>
                  </div>
                  <div class="callout-title-container flex-fill">Note</div>
                </div>
                <div class="callout-body-container callout-body">
                  <p>
                    <strong>Observation:</strong> The distribution of quantile
                    data classification method are more evenly distributed then
                    equal data classification method.
                  </p>
                </div>
              </div>
              <div
                class="callout callout-style-default callout-warning callout-titled"
              >
                <div class="callout-header d-flex align-content-center">
                  <div class="callout-icon-container">
                    <i class="callout-icon"></i>
                  </div>
                  <div class="callout-title-container flex-fill">Warning</div>
                </div>
                <div class="callout-body-container callout-body">
                  <p><strong>Warning: Maps Lie!</strong></p>
                </div>
              </div>
              <p>
                <strong
                  >Exercise: Using what you had learned, prepare choropleth maps
                  by using different classification methods supported by tmap
                  and compare their differences.</strong
                >
              </p>
              <p>
                The tabs below shows the choropleth maps drawn using different
                classifications methods with the same number of classes (n=5).
              </p>
              <div class="tabset-margin-container"></div>
              <div class="panel-tabset">
                <ul class="nav nav-tabs" role="tablist">
                  <li class="nav-item" role="presentation">
                    <a
                      class="nav-link active"
                      id="tabset-1-1-tab"
                      data-bs-toggle="tab"
                      data-bs-target="#tabset-1-1"
                      role="tab"
                      aria-controls="tabset-1-1"
                      aria-selected="true"
                      >quantile</a
                    >
                  </li>
                  <li class="nav-item" role="presentation">
                    <a
                      class="nav-link"
                      id="tabset-1-2-tab"
                      data-bs-toggle="tab"
                      data-bs-target="#tabset-1-2"
                      role="tab"
                      aria-controls="tabset-1-2"
                      aria-selected="false"
                      >equal</a
                    >
                  </li>
                  <li class="nav-item" role="presentation">
                    <a
                      class="nav-link"
                      id="tabset-1-3-tab"
                      data-bs-toggle="tab"
                      data-bs-target="#tabset-1-3"
                      role="tab"
                      aria-controls="tabset-1-3"
                      aria-selected="false"
                      >pretty</a
                    >
                  </li>
                  <li class="nav-item" role="presentation">
                    <a
                      class="nav-link"
                      id="tabset-1-4-tab"
                      data-bs-toggle="tab"
                      data-bs-target="#tabset-1-4"
                      role="tab"
                      aria-controls="tabset-1-4"
                      aria-selected="false"
                      >jenks</a
                    >
                  </li>
                  <li class="nav-item" role="presentation">
                    <a
                      class="nav-link"
                      id="tabset-1-5-tab"
                      data-bs-toggle="tab"
                      data-bs-target="#tabset-1-5"
                      role="tab"
                      aria-controls="tabset-1-5"
                      aria-selected="false"
                      >sd</a
                    >
                  </li>
                  <li class="nav-item" role="presentation">
                    <a
                      class="nav-link"
                      id="tabset-1-6-tab"
                      data-bs-toggle="tab"
                      data-bs-target="#tabset-1-6"
                      role="tab"
                      aria-controls="tabset-1-6"
                      aria-selected="false"
                      >hclust</a
                    >
                  </li>
                  <li class="nav-item" role="presentation">
                    <a
                      class="nav-link"
                      id="tabset-1-7-tab"
                      data-bs-toggle="tab"
                      data-bs-target="#tabset-1-7"
                      role="tab"
                      aria-controls="tabset-1-7"
                      aria-selected="false"
                      >fisher</a
                    >
                  </li>
                  <li class="nav-item" role="presentation">
                    <a
                      class="nav-link"
                      id="tabset-1-8-tab"
                      data-bs-toggle="tab"
                      data-bs-target="#tabset-1-8"
                      role="tab"
                      aria-controls="tabset-1-8"
                      aria-selected="false"
                      >bclust</a
                    >
                  </li>
                  <li class="nav-item" role="presentation">
                    <a
                      class="nav-link"
                      id="tabset-1-9-tab"
                      data-bs-toggle="tab"
                      data-bs-target="#tabset-1-9"
                      role="tab"
                      aria-controls="tabset-1-9"
                      aria-selected="false"
                      >kmeans</a
                    >
                  </li>
                </ul>
                <div class="tab-content">
                  <div
                    id="tabset-1-1"
                    class="tab-pane active"
                    role="tabpanel"
                    aria-labelledby="tabset-1-1-tab"
                  >
                    <div class="cell">
                      <div class="sourceCode" id="cb19">
                        <pre
                          class="downlit sourceCode r code-with-copy"
                        ><code class="sourceCode R"><span><span class="fu">tm_shape</span><span class="op">(</span><span class="va">mpsz_pop2020</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_fill</span><span class="op">(</span><span class="st">"DEPENDENCY"</span>,</span>
<span>          n <span class="op">=</span> <span class="fl">5</span>,</span>
<span>          style <span class="op">=</span> <span class="st">"quantile"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_borders</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
                      </div>
                      <div class="cell-output-display">
                        <div>
                          <figure class="figure">
                            <p>
                              <img
                                src="Hands-on_Ex01b_files/figure-html/unnamed-chunk-17-1.png"
                                class="img-fluid figure-img"
                                width="672"
                              />
                            </p>
                          </figure>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div
                    id="tabset-1-2"
                    class="tab-pane"
                    role="tabpanel"
                    aria-labelledby="tabset-1-2-tab"
                  >
                    <div class="cell">
                      <div class="sourceCode" id="cb20">
                        <pre
                          class="downlit sourceCode r code-with-copy"
                        ><code class="sourceCode R"><span><span class="fu">tm_shape</span><span class="op">(</span><span class="va">mpsz_pop2020</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_fill</span><span class="op">(</span><span class="st">"DEPENDENCY"</span>,</span>
<span>          n <span class="op">=</span> <span class="fl">5</span>,</span>
<span>          style <span class="op">=</span> <span class="st">"equal"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_borders</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
                      </div>
                      <div class="cell-output-display">
                        <div>
                          <figure class="figure">
                            <p>
                              <img
                                src="Hands-on_Ex01b_files/figure-html/unnamed-chunk-18-1.png"
                                class="img-fluid figure-img"
                                width="672"
                              />
                            </p>
                          </figure>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div
                    id="tabset-1-3"
                    class="tab-pane"
                    role="tabpanel"
                    aria-labelledby="tabset-1-3-tab"
                  >
                    <div class="cell">
                      <div class="sourceCode" id="cb21">
                        <pre
                          class="downlit sourceCode r code-with-copy"
                        ><code class="sourceCode R"><span><span class="fu">tm_shape</span><span class="op">(</span><span class="va">mpsz_pop2020</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_fill</span><span class="op">(</span><span class="st">"DEPENDENCY"</span>,</span>
<span>          n <span class="op">=</span> <span class="fl">5</span>,</span>
<span>          style <span class="op">=</span> <span class="st">"pretty"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_borders</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
                      </div>
                      <div class="cell-output-display">
                        <div>
                          <figure class="figure">
                            <p>
                              <img
                                src="Hands-on_Ex01b_files/figure-html/unnamed-chunk-19-1.png"
                                class="img-fluid figure-img"
                                width="672"
                              />
                            </p>
                          </figure>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div
                    id="tabset-1-4"
                    class="tab-pane"
                    role="tabpanel"
                    aria-labelledby="tabset-1-4-tab"
                  >
                    <div class="cell">
                      <div class="sourceCode" id="cb22">
                        <pre
                          class="downlit sourceCode r code-with-copy"
                        ><code class="sourceCode R"><span><span class="fu">tm_shape</span><span class="op">(</span><span class="va">mpsz_pop2020</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_fill</span><span class="op">(</span><span class="st">"DEPENDENCY"</span>,</span>
<span>          n <span class="op">=</span> <span class="fl">5</span>,</span>
<span>          style <span class="op">=</span> <span class="st">"jenks"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_borders</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
                      </div>
                      <div class="cell-output-display">
                        <div>
                          <figure class="figure">
                            <p>
                              <img
                                src="Hands-on_Ex01b_files/figure-html/unnamed-chunk-20-1.png"
                                class="img-fluid figure-img"
                                width="672"
                              />
                            </p>
                          </figure>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div
                    id="tabset-1-5"
                    class="tab-pane"
                    role="tabpanel"
                    aria-labelledby="tabset-1-5-tab"
                  >
                    <div class="cell">
                      <div class="sourceCode" id="cb23">
                        <pre
                          class="downlit sourceCode r code-with-copy"
                        ><code class="sourceCode R"><span><span class="fu">tm_shape</span><span class="op">(</span><span class="va">mpsz_pop2020</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_fill</span><span class="op">(</span><span class="st">"DEPENDENCY"</span>,</span>
<span>          n <span class="op">=</span> <span class="fl">5</span>,</span>
<span>          style <span class="op">=</span> <span class="st">"sd"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_borders</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
                      </div>
                      <div class="cell-output-display">
                        <div>
                          <figure class="figure">
                            <p>
                              <img
                                src="Hands-on_Ex01b_files/figure-html/unnamed-chunk-21-1.png"
                                class="img-fluid figure-img"
                                width="672"
                              />
                            </p>
                          </figure>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div
                    id="tabset-1-6"
                    class="tab-pane"
                    role="tabpanel"
                    aria-labelledby="tabset-1-6-tab"
                  >
                    <div class="cell">
                      <div class="sourceCode" id="cb24">
                        <pre
                          class="downlit sourceCode r code-with-copy"
                        ><code class="sourceCode R"><span><span class="fu">tm_shape</span><span class="op">(</span><span class="va">mpsz_pop2020</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_fill</span><span class="op">(</span><span class="st">"DEPENDENCY"</span>,</span>
<span>          n <span class="op">=</span> <span class="fl">5</span>,</span>
<span>          style <span class="op">=</span> <span class="st">"hclust"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_borders</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
                      </div>
                      <div class="cell-output-display">
                        <div>
                          <figure class="figure">
                            <p>
                              <img
                                src="Hands-on_Ex01b_files/figure-html/unnamed-chunk-22-1.png"
                                class="img-fluid figure-img"
                                width="672"
                              />
                            </p>
                          </figure>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div
                    id="tabset-1-7"
                    class="tab-pane"
                    role="tabpanel"
                    aria-labelledby="tabset-1-7-tab"
                  >
                    <div class="cell">
                      <div class="sourceCode" id="cb25">
                        <pre
                          class="downlit sourceCode r code-with-copy"
                        ><code class="sourceCode R"><span><span class="fu">tm_shape</span><span class="op">(</span><span class="va">mpsz_pop2020</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_fill</span><span class="op">(</span><span class="st">"DEPENDENCY"</span>,</span>
<span>          n <span class="op">=</span> <span class="fl">5</span>,</span>
<span>          style <span class="op">=</span> <span class="st">"fisher"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_borders</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
                      </div>
                      <div class="cell-output-display">
                        <div>
                          <figure class="figure">
                            <p>
                              <img
                                src="Hands-on_Ex01b_files/figure-html/unnamed-chunk-23-1.png"
                                class="img-fluid figure-img"
                                width="672"
                              />
                            </p>
                          </figure>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div
                    id="tabset-1-8"
                    class="tab-pane"
                    role="tabpanel"
                    aria-labelledby="tabset-1-8-tab"
                  >
                    <div class="cell">
                      <div class="sourceCode" id="cb26">
                        <pre
                          class="downlit sourceCode r code-with-copy"
                        ><code class="sourceCode R"><span><span class="fu">tm_shape</span><span class="op">(</span><span class="va">mpsz_pop2020</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_fill</span><span class="op">(</span><span class="st">"DEPENDENCY"</span>,</span>
<span>          n <span class="op">=</span> <span class="fl">5</span>,</span>
<span>          style <span class="op">=</span> <span class="st">"bclust"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_borders</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
                      </div>
                      <div class="cell-output-display">
                        <div>
                          <figure class="figure">
                            <p>
                              <img
                                src="Hands-on_Ex01b_files/figure-html/unnamed-chunk-24-1.png"
                                class="img-fluid figure-img"
                                width="672"
                              />
                            </p>
                          </figure>
                        </div>
                      </div>
                      <div class="cell-output cell-output-stdout">
                        <pre><code>Committee Member: 1(1) 2(1) 3(1) 4(1) 5(1) 6(1) 7(1) 8(1) 9(1) 10(1)
Computing Hierarchical Clustering</code></pre>
                      </div>
                    </div>
                  </div>
                  <div
                    id="tabset-1-9"
                    class="tab-pane"
                    role="tabpanel"
                    aria-labelledby="tabset-1-9-tab"
                  >
                    <div class="cell">
                      <div class="sourceCode" id="cb28">
                        <pre
                          class="downlit sourceCode r code-with-copy"
                        ><code class="sourceCode R"><span><span class="fu">tm_shape</span><span class="op">(</span><span class="va">mpsz_pop2020</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_fill</span><span class="op">(</span><span class="st">"DEPENDENCY"</span>,</span>
<span>          n <span class="op">=</span> <span class="fl">5</span>,</span>
<span>          style <span class="op">=</span> <span class="st">"kmeans"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_borders</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
                      </div>
                      <div class="cell-output-display">
                        <div>
                          <figure class="figure">
                            <p>
                              <img
                                src="Hands-on_Ex01b_files/figure-html/unnamed-chunk-25-1.png"
                                class="img-fluid figure-img"
                                width="672"
                              />
                            </p>
                          </figure>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div
                class="callout callout-style-default callout-note callout-titled"
              >
                <div class="callout-header d-flex align-content-center">
                  <div class="callout-icon-container">
                    <i class="callout-icon"></i>
                  </div>
                  <div class="callout-title-container flex-fill">Note</div>
                </div>
                <div class="callout-body-container callout-body">
                  <p>
                    <strong>Observation:</strong> Different data classification
                    methods produce varying color patterns. Methods like
                    <em>pretty</em>, <em>equal</em>, and <em>sd</em> are more
                    sensitive to outliers, often resulting in fewer distinct
                    areas on the map. In contrast, methods like
                    <em>quantile</em>, <em>jenks</em>, and
                    <em>kmeans</em> create more evenly distributed colors.
                    Therefore, choosing the right classification method based on
                    data distribution is crucial to avoid misleading
                    representations in choropleth maps.
                  </p>
                </div>
              </div>
              <p>
                <strong
                  >Exercise: Preparing choropleth maps by using similar
                  classification method but with different numbers of classes
                  (i.e.&nbsp;2, 6, 10, 20). Compare the output maps, what
                  observation can you draw?</strong
                >
              </p>
              <p>
                The tabs below show choropleth maps with
                <code>kmeans</code> classification method. The numbers of
                classes used are (2, 6, 10, 20).
              </p>
              <div class="tabset-margin-container"></div>
              <div class="panel-tabset">
                <ul class="nav nav-tabs" role="tablist">
                  <li class="nav-item" role="presentation">
                    <a
                      class="nav-link active"
                      id="tabset-2-1-tab"
                      data-bs-toggle="tab"
                      data-bs-target="#tabset-2-1"
                      role="tab"
                      aria-controls="tabset-2-1"
                      aria-selected="true"
                      >n=2</a
                    >
                  </li>
                  <li class="nav-item" role="presentation">
                    <a
                      class="nav-link"
                      id="tabset-2-2-tab"
                      data-bs-toggle="tab"
                      data-bs-target="#tabset-2-2"
                      role="tab"
                      aria-controls="tabset-2-2"
                      aria-selected="false"
                      >n=6</a
                    >
                  </li>
                  <li class="nav-item" role="presentation">
                    <a
                      class="nav-link"
                      id="tabset-2-3-tab"
                      data-bs-toggle="tab"
                      data-bs-target="#tabset-2-3"
                      role="tab"
                      aria-controls="tabset-2-3"
                      aria-selected="false"
                      >n=10</a
                    >
                  </li>
                  <li class="nav-item" role="presentation">
                    <a
                      class="nav-link"
                      id="tabset-2-4-tab"
                      data-bs-toggle="tab"
                      data-bs-target="#tabset-2-4"
                      role="tab"
                      aria-controls="tabset-2-4"
                      aria-selected="false"
                      >n=20</a
                    >
                  </li>
                </ul>
                <div class="tab-content">
                  <div
                    id="tabset-2-1"
                    class="tab-pane active"
                    role="tabpanel"
                    aria-labelledby="tabset-2-1-tab"
                  >
                    <div class="cell">
                      <div class="sourceCode" id="cb29">
                        <pre
                          class="downlit sourceCode r code-with-copy"
                        ><code class="sourceCode R"><span><span class="fu">tm_shape</span><span class="op">(</span><span class="va">mpsz_pop2020</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_fill</span><span class="op">(</span><span class="st">"DEPENDENCY"</span>,</span>
<span>          n <span class="op">=</span> <span class="fl">2</span>,</span>
<span>          style <span class="op">=</span> <span class="st">"kmeans"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_borders</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
                      </div>
                      <div class="cell-output-display">
                        <div>
                          <figure class="figure">
                            <p>
                              <img
                                src="Hands-on_Ex01b_files/figure-html/unnamed-chunk-26-1.png"
                                class="img-fluid figure-img"
                                width="672"
                              />
                            </p>
                          </figure>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div
                    id="tabset-2-2"
                    class="tab-pane"
                    role="tabpanel"
                    aria-labelledby="tabset-2-2-tab"
                  >
                    <div class="cell">
                      <div class="sourceCode" id="cb30">
                        <pre
                          class="downlit sourceCode r code-with-copy"
                        ><code class="sourceCode R"><span><span class="fu">tm_shape</span><span class="op">(</span><span class="va">mpsz_pop2020</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_fill</span><span class="op">(</span><span class="st">"DEPENDENCY"</span>,</span>
<span>          n <span class="op">=</span> <span class="fl">6</span>,</span>
<span>          style <span class="op">=</span> <span class="st">"kmeans"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_borders</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
                      </div>
                      <div class="cell-output-display">
                        <div>
                          <figure class="figure">
                            <p>
                              <img
                                src="Hands-on_Ex01b_files/figure-html/unnamed-chunk-27-1.png"
                                class="img-fluid figure-img"
                                width="672"
                              />
                            </p>
                          </figure>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div
                    id="tabset-2-3"
                    class="tab-pane"
                    role="tabpanel"
                    aria-labelledby="tabset-2-3-tab"
                  >
                    <div class="cell">
                      <div class="sourceCode" id="cb31">
                        <pre
                          class="downlit sourceCode r code-with-copy"
                        ><code class="sourceCode R"><span><span class="fu">tm_shape</span><span class="op">(</span><span class="va">mpsz_pop2020</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_fill</span><span class="op">(</span><span class="st">"DEPENDENCY"</span>,</span>
<span>          n <span class="op">=</span> <span class="fl">10</span>,</span>
<span>          style <span class="op">=</span> <span class="st">"kmeans"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_borders</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
                      </div>
                      <div class="cell-output-display">
                        <div>
                          <figure class="figure">
                            <p>
                              <img
                                src="Hands-on_Ex01b_files/figure-html/unnamed-chunk-28-1.png"
                                class="img-fluid figure-img"
                                width="672"
                              />
                            </p>
                          </figure>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div
                    id="tabset-2-4"
                    class="tab-pane"
                    role="tabpanel"
                    aria-labelledby="tabset-2-4-tab"
                  >
                    <div class="cell">
                      <div class="sourceCode" id="cb32">
                        <pre
                          class="downlit sourceCode r code-with-copy"
                        ><code class="sourceCode R"><span><span class="fu">tm_shape</span><span class="op">(</span><span class="va">mpsz_pop2020</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_fill</span><span class="op">(</span><span class="st">"DEPENDENCY"</span>,</span>
<span>          n <span class="op">=</span> <span class="fl">20</span>,</span>
<span>          style <span class="op">=</span> <span class="st">"kmeans"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_borders</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
                      </div>
                      <div class="cell-output-display">
                        <div>
                          <figure class="figure">
                            <p>
                              <img
                                src="Hands-on_Ex01b_files/figure-html/unnamed-chunk-29-1.png"
                                class="img-fluid figure-img"
                                width="672"
                              />
                            </p>
                          </figure>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div
                class="callout callout-style-default callout-note callout-titled"
              >
                <div class="callout-header d-flex align-content-center">
                  <div class="callout-icon-container">
                    <i class="callout-icon"></i>
                  </div>
                  <div class="callout-title-container flex-fill">Note</div>
                </div>
                <div class="callout-body-container callout-body">
                  <p>
                    <strong>Observation:</strong> Using different class numbers
                    within the same classification method affects the map’s
                    coloring. With n=2, outliers dominate, resulting in only one
                    distinct area. Increasing the class count distributes the
                    data more evenly across the map.
                  </p>
                </div>
              </div>
            </section>
            <section
              id="plotting-choropleth-map-with-custom-break"
              class="level4"
              data-number="7.3.2"
            >
              <h4
                data-number="7.3.2"
                class="anchored"
                data-anchor-id="plotting-choropleth-map-with-custom-break"
              >
                <span class="header-section-number">7.3.2</span> Plotting
                choropleth map with custom break
              </h4>
              <p>
                For all the built-in styles, the category breaks are computed
                internally. In order to override these defaults, the breakpoints
                can be set explicitly by means of the <em>breaks</em> argument
                to the <em>tm_fill()</em>. It is important to note that, in
                <strong>tmap</strong> the breaks include a minimum and maximum.
                As a result, in order to end up with n categories, n+1 elements
                must be specified in the <em>breaks</em> option (the values must
                be in increasing order).
              </p>
              <p>
                Before we get started, it is always a good practice to get some
                descriptive statistics on the variable before setting the break
                points. Code block below will be used to compute and display the
                descriptive statistics of <strong>DEPENDENCY</strong> field.
              </p>
              <div class="cell">
                <div class="sourceCode" id="cb33">
                  <pre
                    class="downlit sourceCode r code-with-copy"
                  ><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mpsz_pop2020</span><span class="op">$</span><span class="va">DEPENDENCY</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
                </div>
                <div class="cell-output cell-output-stdout">
                  <pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's
 0.0000  0.6751  0.7288  0.8084  0.8092 19.0000      92 </code></pre>
                </div>
              </div>
              <p>
                Based on the results, we choose breakpoints at 0.60, 0.70, 0.80,
                and 0.90, with the minimum at 0 and maximum at 1. Our breaks
                vector is c(0, 0.60, 0.70, 0.80, 0.90, 1.00).
              </p>
              <p>
                Now, we will plot the choropleth map with the following code:
              </p>
              <div class="cell">
                <div class="sourceCode" id="cb35">
                  <pre
                    class="downlit sourceCode r code-with-copy"
                  ><code class="sourceCode R"><span><span class="fu">tm_shape</span><span class="op">(</span><span class="va">mpsz_pop2020</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_fill</span><span class="op">(</span><span class="st">"DEPENDENCY"</span>,</span>
<span>          breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.60</span>, <span class="fl">0.70</span>, <span class="fl">0.80</span>, <span class="fl">0.90</span>, <span class="fl">1.00</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_borders</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
                </div>
                <div class="cell-output-display">
                  <div>
                    <figure class="figure">
                      <p>
                        <img
                          src="Hands-on_Ex01b_files/figure-html/unnamed-chunk-31-1.png"
                          class="img-fluid figure-img"
                          width="672"
                        />
                      </p>
                    </figure>
                  </div>
                </div>
              </div>
            </section>
          </section>
          <section id="colour-scheme" class="level3" data-number="7.4">
            <h3
              data-number="7.4"
              class="anchored"
              data-anchor-id="colour-scheme"
            >
              <span class="header-section-number">7.4</span> Colour Scheme
            </h3>
            <p>
              <strong>tmap</strong> supports colour ramps either user-defined or
              a set of predefined colour ramps from the
              <strong>RColorBrewer</strong> package.
            </p>
            <section
              id="using-colourbrewer-palette"
              class="level4"
              data-number="7.4.1"
            >
              <h4
                data-number="7.4.1"
                class="anchored"
                data-anchor-id="using-colourbrewer-palette"
              >
                <span class="header-section-number">7.4.1</span> Using
                ColourBrewer palette
              </h4>
              <p>
                To apply a specific color palette, assign it to the palette
                argument in <code>tm_fill()</code> as shown below:
              </p>
              <div class="cell">
                <div class="sourceCode" id="cb36">
                  <pre
                    class="downlit sourceCode r code-with-copy"
                  ><code class="sourceCode R"><span><span class="fu">tm_shape</span><span class="op">(</span><span class="va">mpsz_pop2020</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_fill</span><span class="op">(</span><span class="st">"DEPENDENCY"</span>,</span>
<span>          n <span class="op">=</span> <span class="fl">6</span>,</span>
<span>          style <span class="op">=</span> <span class="st">"quantile"</span>,</span>
<span>          palette <span class="op">=</span> <span class="st">"Blues"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_borders</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
                </div>
                <div class="cell-output-display">
                  <div>
                    <figure class="figure">
                      <p>
                        <img
                          src="Hands-on_Ex01b_files/figure-html/unnamed-chunk-32-1.png"
                          class="img-fluid figure-img"
                          width="672"
                        />
                      </p>
                    </figure>
                  </div>
                </div>
              </div>
              <p>Notice that the choropleth map is shaded in green.</p>
              <p>To reverse the colour shading, add a “-” prefix.</p>
              <div class="cell">
                <div class="sourceCode" id="cb37">
                  <pre
                    class="downlit sourceCode r code-with-copy"
                  ><code class="sourceCode R"><span><span class="fu">tm_shape</span><span class="op">(</span><span class="va">mpsz_pop2020</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_fill</span><span class="op">(</span><span class="st">"DEPENDENCY"</span>,</span>
<span>          style <span class="op">=</span> <span class="st">"quantile"</span>,</span>
<span>          palette <span class="op">=</span> <span class="st">"-Greens"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_borders</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
                </div>
                <div class="cell-output-display">
                  <div>
                    <figure class="figure">
                      <p>
                        <img
                          src="Hands-on_Ex01b_files/figure-html/unnamed-chunk-33-1.png"
                          class="img-fluid figure-img"
                          width="672"
                        />
                      </p>
                    </figure>
                  </div>
                </div>
              </div>
              <p>Notice that the colour scheme has been reversed.</p>
            </section>
          </section>
          <section id="map-layouts" class="level3" data-number="7.5">
            <h3 data-number="7.5" class="anchored" data-anchor-id="map-layouts">
              <span class="header-section-number">7.5</span> Map Layouts
            </h3>
            <p>
              Map layout refers to the combination of all map elements into a
              cohensive map. Map elements include among others the objects to be
              mapped, the title, the scale bar, the compass, margins and aspects
              ratios. Colour settings and data classification methods covered in
              the previous section relate to the palette and break-points are
              used to affect how the map looks.
            </p>
            <section id="map-legend" class="level4" data-number="7.5.1">
              <h4
                data-number="7.5.1"
                class="anchored"
                data-anchor-id="map-legend"
              >
                <span class="header-section-number">7.5.1</span> Map Legend
              </h4>
              <p>
                In <strong>tmap</strong>, there are several legend options for
                adjusting the placement, format, and style of the legend.
              </p>
              <div class="cell">
                <div class="sourceCode" id="cb38">
                  <pre
                    class="downlit sourceCode r code-with-copy"
                  ><code class="sourceCode R"><span><span class="fu">tm_shape</span><span class="op">(</span><span class="va">mpsz_pop2020</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_fill</span><span class="op">(</span><span class="st">"DEPENDENCY"</span>,</span>
<span>          style <span class="op">=</span> <span class="st">"jenks"</span>,</span>
<span>          palette <span class="op">=</span> <span class="st">"Blues"</span>,</span>
<span>          legend.hist <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>          legend.is.portrait <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>          legend.hist.z <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_layout</span><span class="op">(</span>main.title <span class="op">=</span> <span class="st">"Distribution of Dependency Ratio by planning subzone \n(Jenks classification)"</span>,</span>
<span>            main.title.position <span class="op">=</span> <span class="st">"center"</span>,</span>
<span>            main.title.size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>            legend.height <span class="op">=</span> <span class="fl">0.45</span>,</span>
<span>            legend.width <span class="op">=</span> <span class="fl">0.35</span>,</span>
<span>            legend.outside <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"right"</span>, <span class="st">"bottom"</span><span class="op">)</span>,</span>
<span>            frame <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_borders</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
                </div>
                <div class="cell-output-display">
                  <div>
                    <figure class="figure">
                      <p>
                        <img
                          src="Hands-on_Ex01b_files/figure-html/unnamed-chunk-34-1.png"
                          class="img-fluid figure-img"
                          width="672"
                        />
                      </p>
                    </figure>
                  </div>
                </div>
              </div>
            </section>
            <section id="map-style" class="level4" data-number="7.5.2">
              <h4
                data-number="7.5.2"
                class="anchored"
                data-anchor-id="map-style"
              >
                <span class="header-section-number">7.5.2</span> Map style
              </h4>
              <p>
                <strong>tmap</strong> allows extensive customization of layout
                settings, accessible through the
                <code>tmap_style()</code> function. The code below demonstrates
                the use of the classic style.
              </p>
              <div class="cell">
                <div class="sourceCode" id="cb39">
                  <pre
                    class="downlit sourceCode r code-with-copy"
                  ><code class="sourceCode R"><span><span class="fu">tm_shape</span><span class="op">(</span><span class="va">mpsz_pop2020</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_fill</span><span class="op">(</span><span class="st">"DEPENDENCY"</span>,</span>
<span>          style <span class="op">=</span> <span class="st">"quantile"</span>,</span>
<span>          palette <span class="op">=</span> <span class="st">"-Greens"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_borders</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tmap_style</span><span class="op">(</span><span class="st">"classic"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
                </div>
                <div class="cell-output-display">
                  <div>
                    <figure class="figure">
                      <p>
                        <img
                          src="Hands-on_Ex01b_files/figure-html/unnamed-chunk-35-1.png"
                          class="img-fluid figure-img"
                          width="672"
                        />
                      </p>
                    </figure>
                  </div>
                </div>
              </div>
            </section>
            <section
              id="cartographic-furniture"
              class="level4"
              data-number="7.5.3"
            >
              <h4
                data-number="7.5.3"
                class="anchored"
                data-anchor-id="cartographic-furniture"
              >
                <span class="header-section-number">7.5.3</span> Cartographic
                Furniture
              </h4>
              <p>
                Beside map style, <strong>tmap</strong> also also provides
                arguments to draw other map furniture such as compass, scale bar
                and grid lines. In the following example, <em>tm_compass()</em>,
                <em>tm_scale_bar()</em> and <em>tm_grid()</em> are used to add
                compass, scale bar and grid lines onto the choropleth map.
              </p>
              <div class="cell">
                <div class="sourceCode" id="cb40">
                  <pre
                    class="downlit sourceCode r code-with-copy"
                  ><code class="sourceCode R"><span><span class="fu">tm_shape</span><span class="op">(</span><span class="va">mpsz_pop2020</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_fill</span><span class="op">(</span><span class="st">"DEPENDENCY"</span>,</span>
<span>          style <span class="op">=</span> <span class="st">"quantile"</span>,</span>
<span>          palette <span class="op">=</span> <span class="st">"Blues"</span>,</span>
<span>          title <span class="op">=</span> <span class="st">"No. of persons"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_layout</span><span class="op">(</span>main.title <span class="op">=</span> <span class="st">"Distribution of Dependency Ratio \nby planning subzone"</span>,</span>
<span>            main.title.position <span class="op">=</span> <span class="st">"center"</span>,</span>
<span>            main.title.size <span class="op">=</span> <span class="fl">1.2</span>,</span>
<span>            legend.height <span class="op">=</span> <span class="fl">0.45</span>,</span>
<span>            legend.width <span class="op">=</span> <span class="fl">0.35</span>,</span>
<span>            frame <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_borders</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_compass</span><span class="op">(</span>type<span class="op">=</span><span class="st">"8star"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_scale_bar</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_grid</span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">0.1</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_credits</span><span class="op">(</span><span class="st">"Source: Planning Sub-zone boundary from Urban Redevelopment Authorithy (URA)\n and Population data from Department of Statistics DOS"</span>,</span>
<span>             position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"bottom"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
                </div>
                <div class="cell-output-display">
                  <div>
                    <figure class="figure">
                      <p>
                        <img
                          src="Hands-on_Ex01b_files/figure-html/unnamed-chunk-36-1.png"
                          class="img-fluid figure-img"
                          width="672"
                        />
                      </p>
                    </figure>
                  </div>
                </div>
              </div>
              <p>To reset the default style, use the code below:</p>
              <div class="cell">
                <div class="sourceCode" id="cb41">
                  <pre
                    class="downlit sourceCode r code-with-copy"
                  ><code class="sourceCode R"><span><span class="fu">tmap_style</span><span class="op">(</span><span class="st">"white"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
                </div>
              </div>
            </section>
          </section>
          <section
            id="drawing-small-multiple-choropleth-maps"
            class="level3"
            data-number="7.6"
          >
            <h3
              data-number="7.6"
              class="anchored"
              data-anchor-id="drawing-small-multiple-choropleth-maps"
            >
              <span class="header-section-number">7.6</span> Drawing Small
              Multiple Choropleth Maps
            </h3>
            <p>
              <strong>Small multiple maps</strong>, also referred to as
              <strong>facet maps</strong>, are composed of many maps arrange
              side-by-side, and sometimes stacked vertically. Small multiple
              maps enable the visualisation of how spatial relationships change
              with respect to another variable, such as time.
            </p>
            <p>
              In <strong>tmap</strong>, small multiple maps can be created
              through three methods:
            </p>
            <ul>
              <li>Assigning multiple values to an aesthetic argument.</li>
              <li>
                Defining a grouping variable with <code>tm_facets()</code>.
              </li>
              <li>
                Creating multiple stand-alone maps with
                <code>tmap_arrange()</code>.
              </li>
            </ul>
            <section
              id="assigning-multiple-values-to-an-aesthetic-argument"
              class="level4"
              data-number="7.6.1"
            >
              <h4
                data-number="7.6.1"
                class="anchored"
                data-anchor-id="assigning-multiple-values-to-an-aesthetic-argument"
              >
                <span class="header-section-number">7.6.1</span> Assigning
                Multiple Values to an Aesthetic Argument
              </h4>
              <p>
                In this example, small multiple choropleth maps are created by
                defining <strong><em>ncols</em></strong> in
                <strong>tm_fill()</strong>
              </p>
              <div class="cell">
                <div class="sourceCode" id="cb42">
                  <pre
                    class="downlit sourceCode r code-with-copy"
                  ><code class="sourceCode R"><span><span class="fu">tm_shape</span><span class="op">(</span><span class="va">mpsz_pop2020</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_fill</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"YOUNG"</span>, <span class="st">"AGED"</span><span class="op">)</span>,</span>
<span>          style <span class="op">=</span> <span class="st">"equal"</span>,</span>
<span>          palette <span class="op">=</span> <span class="st">"Blues"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_layout</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"right"</span>, <span class="st">"bottom"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_borders</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tmap_style</span><span class="op">(</span><span class="st">"white"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
                </div>
                <div class="cell-output-display">
                  <div>
                    <figure class="figure">
                      <p>
                        <img
                          src="Hands-on_Ex01b_files/figure-html/unnamed-chunk-38-1.png"
                          class="img-fluid figure-img"
                          width="672"
                        />
                      </p>
                    </figure>
                  </div>
                </div>
              </div>
              <p>
                This example creates small multiple choropleth maps by assigning
                multiple values to at least one of the aesthetic arguments:
              </p>
              <div class="cell">
                <div class="sourceCode" id="cb43">
                  <pre
                    class="downlit sourceCode r code-with-copy"
                  ><code class="sourceCode R"><span><span class="fu">tm_shape</span><span class="op">(</span><span class="va">mpsz_pop2020</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_polygons</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"DEPENDENCY"</span>,<span class="st">"AGED"</span><span class="op">)</span>,</span>
<span>          style <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"equal"</span>, <span class="st">"quantile"</span><span class="op">)</span>,</span>
<span>          palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"Blues"</span>,<span class="st">"Greens"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_layout</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"right"</span>, <span class="st">"bottom"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
                </div>
                <div class="cell-output-display">
                  <div>
                    <figure class="figure">
                      <p>
                        <img
                          src="Hands-on_Ex01b_files/figure-html/unnamed-chunk-39-1.png"
                          class="img-fluid figure-img"
                          width="672"
                        />
                      </p>
                    </figure>
                  </div>
                </div>
              </div>
            </section>
            <section
              id="grouping-by-a-variable-with-tm_facets"
              class="level4"
              data-number="7.6.2"
            >
              <h4
                data-number="7.6.2"
                class="anchored"
                data-anchor-id="grouping-by-a-variable-with-tm_facets"
              >
                <span class="header-section-number">7.6.2</span> Grouping by a
                Variable with <em>tm_facets()</em>
              </h4>
              <p>
                This example generates multiple small maps by using
                <code>tm_facets()</code>.
              </p>
              <div class="cell">
                <div class="sourceCode" id="cb44">
                  <pre
                    class="downlit sourceCode r code-with-copy"
                  ><code class="sourceCode R"><span><span class="fu">tm_shape</span><span class="op">(</span><span class="va">mpsz_pop2020</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_fill</span><span class="op">(</span><span class="st">"DEPENDENCY"</span>,</span>
<span>          style <span class="op">=</span> <span class="st">"quantile"</span>,</span>
<span>          palette <span class="op">=</span> <span class="st">"Blues"</span>,</span>
<span>          thres.poly <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_facets</span><span class="op">(</span>by<span class="op">=</span><span class="st">"REGION_N"</span>,</span>
<span>            free.coords<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>            drop.shapes<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_layout</span><span class="op">(</span>legend.show <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            title.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"center"</span>, <span class="st">"center"</span><span class="op">)</span>,</span>
<span>            title.size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_borders</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
                </div>
                <div class="cell-output-display">
                  <div>
                    <figure class="figure">
                      <p>
                        <img
                          src="Hands-on_Ex01b_files/figure-html/unnamed-chunk-40-1.png"
                          class="img-fluid figure-img"
                          width="672"
                        />
                      </p>
                    </figure>
                  </div>
                </div>
              </div>
            </section>
            <section
              id="creating-stand-alone-maps-with-tmap_arrange"
              class="level4"
              data-number="7.6.3"
            >
              <h4
                data-number="7.6.3"
                class="anchored"
                data-anchor-id="creating-stand-alone-maps-with-tmap_arrange"
              >
                <span class="header-section-number">7.6.3</span> Creating
                Stand-alone Maps with <em>tmap_arrange()</em>
              </h4>
              <p>
                In this example, multiple small choropleth maps are created by
                creating multiple stand-alone maps with
                <strong>tmap_arrange()</strong>.
              </p>
              <div class="cell">
                <div class="sourceCode" id="cb45">
                  <pre
                    class="downlit sourceCode r code-with-copy"
                  ><code class="sourceCode R"><span><span class="va">youngmap</span> <span class="op">&lt;-</span> <span class="fu">tm_shape</span><span class="op">(</span><span class="va">mpsz_pop2020</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_polygons</span><span class="op">(</span><span class="st">"YOUNG"</span>,</span>
<span>              style <span class="op">=</span> <span class="st">"quantile"</span>,</span>
<span>              palette <span class="op">=</span> <span class="st">"Blues"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">agedmap</span> <span class="op">&lt;-</span> <span class="fu">tm_shape</span><span class="op">(</span><span class="va">mpsz_pop2020</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_polygons</span><span class="op">(</span><span class="st">"AGED"</span>,</span>
<span>              style <span class="op">=</span> <span class="st">"quantile"</span>,</span>
<span>              palette <span class="op">=</span> <span class="st">"Blues"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">tmap_arrange</span><span class="op">(</span><span class="va">youngmap</span>, <span class="va">agedmap</span>, asp<span class="op">=</span><span class="fl">1</span>, ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
                </div>
                <div class="cell-output-display">
                  <div>
                    <figure class="figure">
                      <p>
                        <img
                          src="Hands-on_Ex01b_files/figure-html/unnamed-chunk-41-1.png"
                          class="img-fluid figure-img"
                          width="672"
                        />
                      </p>
                    </figure>
                  </div>
                </div>
              </div>
            </section>
          </section>
          <section
            id="mapping-spatial-object-by-meeting-a-selection-criterion"
            class="level3"
            data-number="7.7"
          >
            <h3
              data-number="7.7"
              class="anchored"
              data-anchor-id="mapping-spatial-object-by-meeting-a-selection-criterion"
            >
              <span class="header-section-number">7.7</span> Mapping Spatial
              Object by Meeting a Selection Criterion
            </h3>
            <p>
              Instead of creating small multiple choropleth map, you can also
              use selection function to map spatial objects meeting the
              selection criterion.
            </p>
            <div class="cell">
              <div class="sourceCode" id="cb46">
                <pre
                  class="downlit sourceCode r code-with-copy"
                ><code class="sourceCode R"><span><span class="fu">tm_shape</span><span class="op">(</span><span class="va">mpsz_pop2020</span><span class="op">[</span><span class="va">mpsz_pop2020</span><span class="op">$</span><span class="va">REGION_N</span><span class="op">==</span><span class="st">"CENTRAL REGION"</span>, <span class="op">]</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">tm_fill</span><span class="op">(</span><span class="st">"DEPENDENCY"</span>,</span>
<span>          style <span class="op">=</span> <span class="st">"quantile"</span>,</span>
<span>          palette <span class="op">=</span> <span class="st">"Blues"</span>,</span>
<span>          legend.hist <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>          legend.is.portrait <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>          legend.hist.z <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_layout</span><span class="op">(</span>legend.outside <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>            legend.height <span class="op">=</span> <span class="fl">0.45</span>,</span>
<span>            legend.width <span class="op">=</span> <span class="fl">5.0</span>,</span>
<span>            legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"right"</span>, <span class="st">"bottom"</span><span class="op">)</span>,</span>
<span>            frame <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_borders</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
              </div>
              <div class="cell-output-display">
                <div>
                  <figure class="figure">
                    <p>
                      <img
                        src="Hands-on_Ex01b_files/figure-html/unnamed-chunk-42-1.png"
                        class="img-fluid figure-img"
                        width="672"
                      />
                    </p>
                  </figure>
                </div>
              </div>
            </div>
          </section>
        </section>
        <section id="references" class="level2" data-number="8">
          <h2 data-number="8" class="anchored" data-anchor-id="references">
            <span class="header-section-number">8</span> References
          </h2>
          <section id="all-about-tmap-package" class="level3" data-number="8.1">
            <h3
              data-number="8.1"
              class="anchored"
              data-anchor-id="all-about-tmap-package"
            >
              <span class="header-section-number">8.1</span> All about
              <strong>tmap</strong> package
            </h3>
            <ul>
              <li>
                <a href="https://www.jstatsoft.org/article/view/v084i06"
                  >tmap: Thematic Maps in R</a
                >
              </li>
              <li>
                <a
                  href="https://cran.r-project.org/web/packages/tmap/index.html"
                  >tmap</a
                >
              </li>
              <li>
                <a
                  href="https://cran.r-project.org/web/packages/tmap/vignettes/tmap-getstarted.html"
                  >tmap: get started!</a
                >
              </li>
              <li>
                <a
                  href="https://cran.r-project.org/web/packages/tmap/vignettes/tmap-changes-v2.html"
                  >tmap: changes in version 2.0</a
                >
              </li>
              <li>
                <a
                  href="http://von-tijn.nl/tijn/research/presentations/tmap_user2015.pdf"
                  >tmap: creating thematic maps in a flexible way (useR!2015)</a
                >
              </li>
              <li>
                <a
                  href="http://von-tijn.nl/tijn/research/presentations/tmap_user2017.pdf"
                  >Exploring and presenting maps with tmap (useR!2017)</a
                >
              </li>
            </ul>
          </section>
          <section
            id="geospatial-data-wrangling"
            class="level3"
            data-number="8.2"
          >
            <h3
              data-number="8.2"
              class="anchored"
              data-anchor-id="geospatial-data-wrangling"
            >
              <span class="header-section-number">8.2</span> Geospatial Data
              Wrangling
            </h3>
            <ul>
              <li>
                <a href="https://cran.r-project.org/web/packages/sf/index.html"
                  >sf: Simple Features for R</a
                >
              </li>
              <li>
                <a
                  href="https://journal.r-project.org/archive/2018/RJ-2018-009/RJ-2018-009.pdf"
                  >Simple Features for R: StandardizedSupport for Spatial Vector
                  Data</a
                >
              </li>
              <li>
                <a
                  href="https://cran.r-project.org/web/packages/sf/vignettes/sf2.html"
                  >Reading, Writing and Converting Simple Features</a
                >
              </li>
            </ul>
          </section>
          <section id="data-wrangling-1" class="level3" data-number="8.3">
            <h3
              data-number="8.3"
              class="anchored"
              data-anchor-id="data-wrangling-1"
            >
              <span class="header-section-number">8.3</span> Data Wrangling
            </h3>
            <ul>
              <li><a href="https://dplyr.tidyverse.org/">dplyr</a></li>
              <li>
                <a
                  href="https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html"
                  >Tidy data</a
                >
              </li>
              <li>
                <a
                  href="https://cran.r-project.org/web/packages/tidyr/tidyr.pdf"
                  >tidyr: Easily Tidy Data with ‘spread()’ and ‘gather()’
                  Functions</a
                >
              </li>
            </ul>
          </section>
        </section>
      </main>
      <!-- /main -->
      <script id="quarto-html-after-body" type="application/javascript">
        window.document.addEventListener("DOMContentLoaded", function (event) {
          const toggleBodyColorMode = (bsSheetEl) => {
            const mode = bsSheetEl.getAttribute("data-mode");
            const bodyEl = window.document.querySelector("body");
            if (mode === "dark") {
              bodyEl.classList.add("quarto-dark");
              bodyEl.classList.remove("quarto-light");
            } else {
              bodyEl.classList.add("quarto-light");
              bodyEl.classList.remove("quarto-dark");
            }
          };
          const toggleBodyColorPrimary = () => {
            const bsSheetEl = window.document.querySelector(
              "link#quarto-bootstrap"
            );
            if (bsSheetEl) {
              toggleBodyColorMode(bsSheetEl);
            }
          };
          toggleBodyColorPrimary();
          const disableStylesheet = (stylesheets) => {
            for (let i = 0; i < stylesheets.length; i++) {
              const stylesheet = stylesheets[i];
              stylesheet.rel = "prefetch";
            }
          };
          const enableStylesheet = (stylesheets) => {
            for (let i = 0; i < stylesheets.length; i++) {
              const stylesheet = stylesheets[i];
              stylesheet.rel = "stylesheet";
            }
          };
          const manageTransitions = (selector, allowTransitions) => {
            const els = window.document.querySelectorAll(selector);
            for (let i = 0; i < els.length; i++) {
              const el = els[i];
              if (allowTransitions) {
                el.classList.remove("notransition");
              } else {
                el.classList.add("notransition");
              }
            }
          };
          const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
            const baseTheme =
              document.querySelector("#giscus-base-theme")?.value ?? "light";
            const alternateTheme =
              document.querySelector("#giscus-alt-theme")?.value ?? "dark";
            let newTheme = "";
            if (darkModeDefault) {
              newTheme = isAlternate ? baseTheme : alternateTheme;
            } else {
              newTheme = isAlternate ? alternateTheme : baseTheme;
            }
            const changeGiscusTheme = () => {
              // From: https://github.com/giscus/giscus/issues/336
              const sendMessage = (message) => {
                const iframe = document.querySelector("iframe.giscus-frame");
                if (!iframe) return;
                iframe.contentWindow.postMessage(
                  { giscus: message },
                  "https://giscus.app"
                );
              };
              sendMessage({
                setConfig: {
                  theme: newTheme,
                },
              });
            };
            const isGiscussLoaded =
              window.document.querySelector("iframe.giscus-frame") !== null;
            if (isGiscussLoaded) {
              changeGiscusTheme();
            }
          };
          const toggleColorMode = (alternate) => {
            // Switch the stylesheets
            const alternateStylesheets = window.document.querySelectorAll(
              "link.quarto-color-scheme.quarto-color-alternate"
            );
            manageTransitions("#quarto-margin-sidebar .nav-link", false);
            if (alternate) {
              enableStylesheet(alternateStylesheets);
              for (const sheetNode of alternateStylesheets) {
                if (sheetNode.id === "quarto-bootstrap") {
                  toggleBodyColorMode(sheetNode);
                }
              }
            } else {
              disableStylesheet(alternateStylesheets);
              toggleBodyColorPrimary();
            }
            manageTransitions("#quarto-margin-sidebar .nav-link", true);
            // Switch the toggles
            const toggles = window.document.querySelectorAll(
              ".quarto-color-scheme-toggle"
            );
            for (let i = 0; i < toggles.length; i++) {
              const toggle = toggles[i];
              if (toggle) {
                if (alternate) {
                  toggle.classList.add("alternate");
                } else {
                  toggle.classList.remove("alternate");
                }
              }
            }
            // Hack to workaround the fact that safari doesn't
            // properly recolor the scrollbar when toggling (#1455)
            if (
              navigator.userAgent.indexOf("Safari") > 0 &&
              navigator.userAgent.indexOf("Chrome") == -1
            ) {
              manageTransitions("body", false);
              window.scrollTo(0, 1);
              setTimeout(() => {
                window.scrollTo(0, 0);
                manageTransitions("body", true);
              }, 40);
            }
          };
          const isFileUrl = () => {
            return window.location.protocol === "file:";
          };
          const hasAlternateSentinel = () => {
            let styleSentinel = getColorSchemeSentinel();
            if (styleSentinel !== null) {
              return styleSentinel === "alternate";
            } else {
              return false;
            }
          };
          const setStyleSentinel = (alternate) => {
            const value = alternate ? "alternate" : "default";
            if (!isFileUrl()) {
              window.localStorage.setItem("quarto-color-scheme", value);
            } else {
              localAlternateSentinel = value;
            }
          };
          const getColorSchemeSentinel = () => {
            if (!isFileUrl()) {
              const storageValue = window.localStorage.getItem(
                "quarto-color-scheme"
              );
              return storageValue != null
                ? storageValue
                : localAlternateSentinel;
            } else {
              return localAlternateSentinel;
            }
          };
          const darkModeDefault = true;
          let localAlternateSentinel = darkModeDefault
            ? "alternate"
            : "default";
          // Dark / light mode switch
          window.quartoToggleColorScheme = () => {
            // Read the current dark / light value
            let toAlternate = !hasAlternateSentinel();
            toggleColorMode(toAlternate);
            setStyleSentinel(toAlternate);
            toggleGiscusIfUsed(toAlternate, darkModeDefault);
          };
          // Ensure there is a toggle, if there isn't float one in the top right
          if (
            window.document.querySelector(".quarto-color-scheme-toggle") ===
            null
          ) {
            const a = window.document.createElement("a");
            a.classList.add("top-right");
            a.classList.add("quarto-color-scheme-toggle");
            a.href = "";
            a.onclick = function () {
              try {
                window.quartoToggleColorScheme();
              } catch {}
              return false;
            };
            const i = window.document.createElement("i");
            i.classList.add("bi");
            a.appendChild(i);
            window.document.body.appendChild(a);
          }
          // Switch to dark mode if need be
          if (hasAlternateSentinel()) {
            toggleColorMode(true);
          } else {
            toggleColorMode(false);
          }
          const icon = "";
          const anchorJS = new window.AnchorJS();
          anchorJS.options = {
            placement: "right",
            icon: icon,
          };
          anchorJS.add(".anchored");
          const isCodeAnnotation = (el) => {
            for (const clz of el.classList) {
              if (clz.startsWith("code-annotation-")) {
                return true;
              }
            }
            return false;
          };
          const onCopySuccess = function (e) {
            // button target
            const button = e.trigger;
            // don't keep focus
            button.blur();
            // flash "checked"
            button.classList.add("code-copy-button-checked");
            var currentTitle = button.getAttribute("title");
            button.setAttribute("title", "Copied!");
            let tooltip;
            if (window.bootstrap) {
              button.setAttribute("data-bs-toggle", "tooltip");
              button.setAttribute("data-bs-placement", "left");
              button.setAttribute("data-bs-title", "Copied!");
              tooltip = new bootstrap.Tooltip(button, {
                trigger: "manual",
                customClass: "code-copy-button-tooltip",
                offset: [0, -8],
              });
              tooltip.show();
            }
            setTimeout(function () {
              if (tooltip) {
                tooltip.hide();
                button.removeAttribute("data-bs-title");
                button.removeAttribute("data-bs-toggle");
                button.removeAttribute("data-bs-placement");
              }
              button.setAttribute("title", currentTitle);
              button.classList.remove("code-copy-button-checked");
            }, 1000);
            // clear code selection
            e.clearSelection();
          };
          const getTextToCopy = function (trigger) {
            const codeEl = trigger.previousElementSibling.cloneNode(true);
            for (const childEl of codeEl.children) {
              if (isCodeAnnotation(childEl)) {
                childEl.remove();
              }
            }
            return codeEl.innerText;
          };
          const clipboard = new window.ClipboardJS(
            ".code-copy-button:not([data-in-quarto-modal])",
            {
              text: getTextToCopy,
            }
          );
          clipboard.on("success", onCopySuccess);
          if (
            window.document.getElementById("quarto-embedded-source-code-modal")
          ) {
            // For code content inside modals, clipBoardJS needs to be initialized with a container option
            // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
            const clipboardModal = new window.ClipboardJS(
              ".code-copy-button[data-in-quarto-modal]",
              {
                text: getTextToCopy,
                container: window.document.getElementById(
                  "quarto-embedded-source-code-modal"
                ),
              }
            );
            clipboardModal.on("success", onCopySuccess);
          }
          var localhostRegex = new RegExp(
            /^(?:http|https):\/\/localhost\:?[0-9]*\//
          );
          var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp("https:\/\/isss626-gaa\.netlify\.app\/");
          var isInternal = (href) => {
            return (
              filterRegex.test(href) ||
              localhostRegex.test(href) ||
              mailtoRegex.test(href)
            );
          };
          // Inspect non-navigation links and adorn them if external
          var links = window.document.querySelectorAll(
            "a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)"
          );
          for (var i = 0; i < links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
          function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
            const config = {
              allowHTML: true,
              maxWidth: 500,
              delay: 100,
              arrow: false,
              appendTo: function (el) {
                return el.parentElement;
              },
              interactive: true,
              interactiveBorder: 10,
              theme: "quarto",
              placement: "bottom-start",
            };
            if (contentFn) {
              config.content = contentFn;
            }
            if (onTriggerFn) {
              config.onTrigger = onTriggerFn;
            }
            if (onUntriggerFn) {
              config.onUntrigger = onUntriggerFn;
            }
            window.tippy(el, config);
          }
          const noterefs = window.document.querySelectorAll(
            'a[role="doc-noteref"]'
          );
          for (var i = 0; i < noterefs.length; i++) {
            const ref = noterefs[i];
            tippyHover(ref, function () {
              // use id or data attribute instead here
              let href =
                ref.getAttribute("data-footnote-href") ||
                ref.getAttribute("href");
              try {
                href = new URL(href).hash;
              } catch {}
              const id = href.replace(/^#\/?/, "");
              const note = window.document.getElementById(id);
              if (note) {
                return note.innerHTML;
              } else {
                return "";
              }
            });
          }
          const xrefs = window.document.querySelectorAll("a.quarto-xref");
          const processXRef = (id, note) => {
            // Strip column container classes
            const stripColumnClz = (el) => {
              el.classList.remove("page-full", "page-columns");
              if (el.children) {
                for (const child of el.children) {
                  stripColumnClz(child);
                }
              }
            };
            stripColumnClz(note);
            if (id === null || id.startsWith("sec-")) {
              // Special case sections, only their first couple elements
              const container = document.createElement("div");
              if (note.children && note.children.length > 2) {
                container.appendChild(note.children[0].cloneNode(true));
                for (let i = 1; i < note.children.length; i++) {
                  const child = note.children[i];
                  if (child.tagName === "P" && child.innerText === "") {
                    continue;
                  } else {
                    container.appendChild(child.cloneNode(true));
                    break;
                  }
                }
                if (window.Quarto?.typesetMath) {
                  window.Quarto.typesetMath(container);
                }
                return container.innerHTML;
              } else {
                if (window.Quarto?.typesetMath) {
                  window.Quarto.typesetMath(note);
                }
                return note.innerHTML;
              }
            } else {
              // Remove any anchor links if they are present
              const anchorLink = note.querySelector("a.anchorjs-link");
              if (anchorLink) {
                anchorLink.remove();
              }
              if (window.Quarto?.typesetMath) {
                window.Quarto.typesetMath(note);
              }
              // TODO in 1.5, we should make sure this works without a callout special case
              if (note.classList.contains("callout")) {
                return note.outerHTML;
              } else {
                return note.innerHTML;
              }
            }
          };
          for (var i = 0; i < xrefs.length; i++) {
            const xref = xrefs[i];
            tippyHover(
              xref,
              undefined,
              function (instance) {
                instance.disable();
                let url = xref.getAttribute("href");
                let hash = undefined;
                if (url.startsWith("#")) {
                  hash = url;
                } else {
                  try {
                    hash = new URL(url).hash;
                  } catch {}
                }
                if (hash) {
                  const id = hash.replace(/^#\/?/, "");
                  const note = window.document.getElementById(id);
                  if (note !== null) {
                    try {
                      const html = processXRef(id, note.cloneNode(true));
                      instance.setContent(html);
                    } finally {
                      instance.enable();
                      instance.show();
                    }
                  } else {
                    // See if we can fetch this
                    fetch(url.split("#")[0])
                      .then((res) => res.text())
                      .then((html) => {
                        const parser = new DOMParser();
                        const htmlDoc = parser.parseFromString(
                          html,
                          "text/html"
                        );
                        const note = htmlDoc.getElementById(id);
                        if (note !== null) {
                          const html = processXRef(id, note);
                          instance.setContent(html);
                        }
                      })
                      .finally(() => {
                        instance.enable();
                        instance.show();
                      });
                  }
                } else {
                  // See if we can fetch a full url (with no hash to target)
                  // This is a special case and we should probably do some content thinning / targeting
                  fetch(url)
                    .then((res) => res.text())
                    .then((html) => {
                      const parser = new DOMParser();
                      const htmlDoc = parser.parseFromString(html, "text/html");
                      const note = htmlDoc.querySelector("main.content");
                      if (note !== null) {
                        // This should only happen for chapter cross references
                        // (since there is no id in the URL)
                        // remove the first header
                        if (
                          note.children.length > 0 &&
                          note.children[0].tagName === "HEADER"
                        ) {
                          note.children[0].remove();
                        }
                        const html = processXRef(null, note);
                        instance.setContent(html);
                      }
                    })
                    .finally(() => {
                      instance.enable();
                      instance.show();
                    });
                }
              },
              function (instance) {}
            );
          }
          let selectedAnnoteEl;
          const selectorForAnnotation = (cell, annotation) => {
            let cellAttr = 'data-code-cell="' + cell + '"';
            let lineAttr = 'data-code-annotation="' + annotation + '"';
            const selector = "span[" + cellAttr + "][" + lineAttr + "]";
            return selector;
          };
          const selectCodeLines = (annoteEl) => {
            const doc = window.document;
            const targetCell = annoteEl.getAttribute("data-target-cell");
            const targetAnnotation = annoteEl.getAttribute(
              "data-target-annotation"
            );
            const annoteSpan = window.document.querySelector(
              selectorForAnnotation(targetCell, targetAnnotation)
            );
            const lines = annoteSpan.getAttribute("data-code-lines").split(",");
            const lineIds = lines.map((line) => {
              return targetCell + "-" + line;
            });
            let top = null;
            let height = null;
            let parent = null;
            if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
              if (lineIds.length > 1) {
                const lastEl = window.document.getElementById(
                  lineIds[lineIds.length - 1]
                );
                const bottom = lastEl.offsetTop + lastEl.offsetHeight;
                height = bottom - top;
              }
              if (top !== null && height !== null && parent !== null) {
                // cook up a div (if necessary) and position it
                let div = window.document.getElementById(
                  "code-annotation-line-highlight"
                );
                if (div === null) {
                  div = window.document.createElement("div");
                  div.setAttribute("id", "code-annotation-line-highlight");
                  div.style.position = "absolute";
                  parent.appendChild(div);
                }
                div.style.top = top - 2 + "px";
                div.style.height = height + 4 + "px";
                div.style.left = 0;
                let gutterDiv = window.document.getElementById(
                  "code-annotation-line-highlight-gutter"
                );
                if (gutterDiv === null) {
                  gutterDiv = window.document.createElement("div");
                  gutterDiv.setAttribute(
                    "id",
                    "code-annotation-line-highlight-gutter"
                  );
                  gutterDiv.style.position = "absolute";
                  const codeCell = window.document.getElementById(targetCell);
                  const gutter = codeCell.querySelector(
                    ".code-annotation-gutter"
                  );
                  gutter.appendChild(gutterDiv);
                }
                gutterDiv.style.top = top - 2 + "px";
                gutterDiv.style.height = height + 4 + "px";
              }
              selectedAnnoteEl = annoteEl;
            }
          };
          const unselectCodeLines = () => {
            const elementsIds = [
              "code-annotation-line-highlight",
              "code-annotation-line-highlight-gutter",
            ];
            elementsIds.forEach((elId) => {
              const div = window.document.getElementById(elId);
              if (div) {
                div.remove();
              }
            });
            selectedAnnoteEl = undefined;
          };
          // Handle positioning of the toggle
          window.addEventListener(
            "resize",
            throttle(() => {
              elRect = undefined;
              if (selectedAnnoteEl) {
                selectCodeLines(selectedAnnoteEl);
              }
            }, 10)
          );
          function throttle(fn, ms) {
            let throttle = false;
            let timer;
            return (...args) => {
              if (!throttle) {
                // first call gets through
                fn.apply(this, args);
                throttle = true;
              } else {
                // all the others get throttled
                if (timer) clearTimeout(timer); // cancel #2
                timer = setTimeout(() => {
                  fn.apply(this, args);
                  timer = throttle = false;
                }, ms);
              }
            };
          }
          // Attach click handler to the DT
          const annoteDls = window.document.querySelectorAll(
            "dt[data-target-cell]"
          );
          for (const annoteDlNode of annoteDls) {
            annoteDlNode.addEventListener("click", (event) => {
              const clickedEl = event.target;
              if (clickedEl !== selectedAnnoteEl) {
                unselectCodeLines();
                const activeEl = window.document.querySelector(
                  "dt[data-target-cell].code-annotation-active"
                );
                if (activeEl) {
                  activeEl.classList.remove("code-annotation-active");
                }
                selectCodeLines(clickedEl);
                clickedEl.classList.add("code-annotation-active");
              } else {
                // Unselect the line
                unselectCodeLines();
                clickedEl.classList.remove("code-annotation-active");
              }
            });
          }
          const findCites = (el) => {
            const parentEl = el.parentElement;
            if (parentEl) {
              const cites = parentEl.dataset.cites;
              if (cites) {
                return {
                  el,
                  cites: cites.split(" "),
                };
              } else {
                return findCites(el.parentElement);
              }
            } else {
              return undefined;
            }
          };
          var bibliorefs = window.document.querySelectorAll(
            'a[role="doc-biblioref"]'
          );
          for (var i = 0; i < bibliorefs.length; i++) {
            const ref = bibliorefs[i];
            const citeInfo = findCites(ref);
            if (citeInfo) {
              tippyHover(citeInfo.el, function () {
                var popup = window.document.createElement("div");
                citeInfo.cites.forEach(function (cite) {
                  var citeDiv = window.document.createElement("div");
                  citeDiv.classList.add("hanging-indent");
                  citeDiv.classList.add("csl-entry");
                  var biblioDiv = window.document.getElementById("ref-" + cite);
                  if (biblioDiv) {
                    citeDiv.innerHTML = biblioDiv.innerHTML;
                  }
                  popup.appendChild(citeDiv);
                });
                return popup.innerHTML;
              });
            }
          }
        });
      </script>
    </div>
    <!-- /content -->
  </body>
</html>

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Teng Kok Wai (Walter)">
<meta name="dcterms.date" content="2024-09-05">

<title>01 Spatial Data Handline – Walter Teng's Coursework for SMU ISSS626: Geospatial Analytics and Applications</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-4MGB7PXBSL"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-4MGB7PXBSL', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="../../../styles.css">
<meta property="og:title" content="01 Spatial Data Handling – Walter Teng’s Coursework for SMU ISSS626: Geospatial Analytics and Applications">
<meta property="og:description" content="In this exercise, we will handle spatial data to create a choropleth map of abandoned vehicles per capita in Chicago by downloading, filtering, transforming data, and using spatial join and aggregation techniques.">
<meta property="og:image" content="https://isss626-gaa.netlify.app/Exploration/CSDS/01-spatial-data-handling/og-img.png">
<meta property="og:site_name" content="Walter Teng's Coursework for SMU ISSS626: Geospatial Analytics and Applications">
<meta name="twitter:title" content="01 Spatial Data Handling – Walter Teng’s Coursework for SMU ISSS626: Geospatial Analytics and Applications">
<meta name="twitter:description" content="In this exercise, we will handle spatial data to create a choropleth map of abandoned vehicles per capita in Chicago by downloading, filtering, transforming data, and using spatial join and aggregation techniques.">
<meta name="twitter:image" content="https://isss626-gaa.netlify.app/Exploration/CSDS/01-spatial-data-handling/og-img.png">
<meta name="twitter:creator" content="@davzoku">
<meta name="twitter:site" content="@davzoku">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">ISSS626 Geospatial Analytics and Applications</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercises" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Hands-on Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercises">    
        <li>
    <a class="dropdown-item" href="../../../Hands-on_Ex/Hands-on_Ex01/Hands-on_Ex01a.html">
 <span class="dropdown-text">1A: Geospatial Data Wrangling with R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../Hands-on_Ex/Hands-on_Ex01/Hands-on_Ex01b.html">
 <span class="dropdown-text">1B: Choropleth Mapping with R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../Hands-on_Ex/Hands-on_Ex02/Hands-on_Ex02a.html">
 <span class="dropdown-text">2A: 1st Order Spatial Point Patterns Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../Hands-on_Ex/Hands-on_Ex02/Hands-on_Ex02b.html">
 <span class="dropdown-text">2B: 2nd Order Spatial Point Patterns Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../Hands-on_Ex/Hands-on_Ex03/Hands-on_Ex03a.html">
 <span class="dropdown-text">3A: Network Constrained Spatial Point Patterns Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../Hands-on_Ex/Hands-on_Ex04/Hands-on_Ex04a.html">
 <span class="dropdown-text">4A: Spatial Weights and Applications</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../Hands-on_Ex/Hands-on_Ex05/Hands-on_Ex05a.html">
 <span class="dropdown-text">5A: Global Measures of Spatial Autocorrelation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../Hands-on_Ex/Hands-on_Ex05/Hands-on_Ex05b.html">
 <span class="dropdown-text">5B: Local Measures of Spatial Autocorrelation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../Hands-on_Ex/Hands-on_Ex06/Hands-on_Ex06a.html">
 <span class="dropdown-text">6A: Geographical Segmentation with Spatially Constrained Clustering Techniques</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../Hands-on_Ex/Hands-on_Ex07/Hands-on_Ex07a.html">
 <span class="dropdown-text">7A: Calibrating Hedonic Pricing Model for Private Highrise Property with GWR Method</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../Hands-on_Ex/Hands-on_Ex08/Hands-on_Ex08a.html">
 <span class="dropdown-text">8A: Geographically Weighted Predictive Models</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../Hands-on_Ex/Hands-on_Ex09/Hands-on_Ex09a.html">
 <span class="dropdown-text">9A: Processing and Visualising Flow Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../Hands-on_Ex/Hands-on_Ex09/Hands-on_Ex09b.html">
 <span class="dropdown-text">9B: Calibrating Spatial Interaction Models with R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../Hands-on_Ex/Hands-on_Ex10/Hands-on_Ex10a.html">
 <span class="dropdown-text">10A: Modelling Geographical Accessibility</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercises" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">In-class Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercises">    
        <li>
    <a class="dropdown-item" href="../../../In-class_Ex/In-class_Ex01/In-class_Ex01.html">
 <span class="dropdown-text">In-class Exercise 01</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../In-class_Ex/In-class_Ex02/In-class_Ex02.html">
 <span class="dropdown-text">In-class Exercise 02</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../In-class_Ex/In-class_Ex03/In-class_Ex03.html">
 <span class="dropdown-text">In-class Exercise 03</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../In-class_Ex/In-class_Ex04/In-class_Ex04.html">
 <span class="dropdown-text">In-class Exercise 04</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../In-class_Ex/In-class_Ex05/In-class_Ex05.html">
 <span class="dropdown-text">In-class Exercise 05</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../In-class_Ex/In-class_Ex06/In-class_Ex06.html">
 <span class="dropdown-text">In-class Exercise 06</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../In-class_Ex/In-class_Ex07/In-class_Ex07.html">
 <span class="dropdown-text">In-class Exercise 07</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../In-class_Ex/In-class_Ex08/In-class_Ex08.html">
 <span class="dropdown-text">In-class Exercise 08</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../In-class_Ex/In-class_Ex09/In-class_Ex09.html">
 <span class="dropdown-text">In-class Exercise 09</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../In-class_Ex/In-class_Ex10/In-class_Ex10.html">
 <span class="dropdown-text">In-class Exercise 10</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercises" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Take-home Exercises</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercises">    
        <li>
    <a class="dropdown-item" href="../../../Take-home_Ex/Take-home_Ex01/Take-home_Ex01.html">
 <span class="dropdown-text">Take-home Exercise 01</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../Take-home_Ex/Take-home_Ex02/Take-home_Ex02.html">
 <span class="dropdown-text">Take-home Exercise 02</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../Take-home_Ex/Take-home_Ex03/Take-home_Ex03.html">
 <span class="dropdown-text">Take-home Exercise 03</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../../Exploration/index.html"> 
<span class="menu-text">Exploration</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html"> 
<span class="menu-text"><i class="fa-solid fa-house fa-md" aria-label="house"></i></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.walterteng.com"> 
<span class="menu-text"><i class="fa-solid fa-user fa-md" aria-label="user"></i></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/tengkokwai/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/davzoku/isss626-gaa"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#exercise-reference" id="toc-exercise-reference" class="nav-link active" data-scroll-target="#exercise-reference"><span class="header-section-number">1</span> Exercise Reference</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction"><span class="header-section-number">2</span> Introduction</a></li>
  <li><a href="#learning-outcome" id="toc-learning-outcome" class="nav-link" data-scroll-target="#learning-outcome"><span class="header-section-number">3</span> Learning Outcome</a></li>
  <li><a href="#r-packages-used" id="toc-r-packages-used" class="nav-link" data-scroll-target="#r-packages-used"><span class="header-section-number">4</span> R Packages Used</a>
  <ul class="collapse">
  <li><a href="#r-commands-used" id="toc-r-commands-used" class="nav-link" data-scroll-target="#r-commands-used"><span class="header-section-number">4.1</span> R Commands Used</a></li>
  </ul></li>
  <li><a href="#obtaining-data-from-the-chicago-open-data-portal" id="toc-obtaining-data-from-the-chicago-open-data-portal" class="nav-link" data-scroll-target="#obtaining-data-from-the-chicago-open-data-portal"><span class="header-section-number">5</span> Obtaining data from the Chicago Open Data portal</a>
  <ul class="collapse">
  <li><a href="#extracting-observations-for-the-desired-time-period" id="toc-extracting-observations-for-the-desired-time-period" class="nav-link" data-scroll-target="#extracting-observations-for-the-desired-time-period"><span class="header-section-number">5.1</span> Extracting observations for the desired time period</a></li>
  <li><a href="#selecting-the-variables-for-the-final-table" id="toc-selecting-the-variables-for-the-final-table" class="nav-link" data-scroll-target="#selecting-the-variables-for-the-final-table"><span class="header-section-number">5.2</span> Selecting the variables for the final table</a></li>
  </ul></li>
  <li><a href="#creating-a-point-layer" id="toc-creating-a-point-layer" class="nav-link" data-scroll-target="#creating-a-point-layer"><span class="header-section-number">6</span> Creating a Point Layer</a>
  <ul class="collapse">
  <li><a href="#creating-a-point-layer-from-coordinates-in-a-table---principle" id="toc-creating-a-point-layer-from-coordinates-in-a-table---principle" class="nav-link" data-scroll-target="#creating-a-point-layer-from-coordinates-in-a-table---principle"><span class="header-section-number">6.1</span> Creating a point layer from coordinates in a table - principle</a></li>
  <li><a href="#creating-a-spatial-points-object" id="toc-creating-a-spatial-points-object" class="nav-link" data-scroll-target="#creating-a-spatial-points-object"><span class="header-section-number">6.2</span> Creating a spatial points object</a></li>
  </ul></li>
  <li><a href="#abandoned-vehicles-by-community-area" id="toc-abandoned-vehicles-by-community-area" class="nav-link" data-scroll-target="#abandoned-vehicles-by-community-area"><span class="header-section-number">7</span> Abandoned Vehicles by Community Area</a>
  <ul class="collapse">
  <li><a href="#community-area-boundary-file" id="toc-community-area-boundary-file" class="nav-link" data-scroll-target="#community-area-boundary-file">Community Area boundary file</a></li>
  <li><a href="#spatial-join" id="toc-spatial-join" class="nav-link" data-scroll-target="#spatial-join"><span class="header-section-number">7.1</span> Spatial join</a></li>
  <li><a href="#counts-by-community-area" id="toc-counts-by-community-area" class="nav-link" data-scroll-target="#counts-by-community-area"><span class="header-section-number">7.2</span> Counts by community area</a></li>
  <li><a href="#mapping-the-vehicle-counts" id="toc-mapping-the-vehicle-counts" class="nav-link" data-scroll-target="#mapping-the-vehicle-counts"><span class="header-section-number">7.3</span> Mapping the vehicle counts</a></li>
  </ul></li>
  <li><a href="#community-area-population-data" id="toc-community-area-population-data" class="nav-link" data-scroll-target="#community-area-population-data"><span class="header-section-number">8</span> Community Area Population Data</a>
  <ul class="collapse">
  <li><a href="#extracting-a-pdf-file" id="toc-extracting-a-pdf-file" class="nav-link" data-scroll-target="#extracting-a-pdf-file"><span class="header-section-number">8.1</span> Extracting a pdf file</a></li>
  <li><a href="#parsing-the-pdf-file" id="toc-parsing-the-pdf-file" class="nav-link" data-scroll-target="#parsing-the-pdf-file">Parsing the pdf file</a></li>
  <li><a href="#extracting-the-population-values" id="toc-extracting-the-population-values" class="nav-link" data-scroll-target="#extracting-the-population-values"><span class="header-section-number">8.2</span> Extracting the population values</a></li>
  <li><a href="#creating-a-data-frame-with-population-values" id="toc-creating-a-data-frame-with-population-values" class="nav-link" data-scroll-target="#creating-a-data-frame-with-population-values">Creating a data frame with population values</a></li>
  </ul></li>
  <li><a href="#mapping-community-area-abandoned-vehicles-per-capita" id="toc-mapping-community-area-abandoned-vehicles-per-capita" class="nav-link" data-scroll-target="#mapping-community-area-abandoned-vehicles-per-capita">Mapping Community Area Abandoned Vehicles Per Capita</a>
  <ul class="collapse">
  <li><a href="#computing-abandoned-vehicles-per-capita" id="toc-computing-abandoned-vehicles-per-capita" class="nav-link" data-scroll-target="#computing-abandoned-vehicles-per-capita">Computing abandoned vehicles per capita</a></li>
  <li><a href="#final-choropleth-map" id="toc-final-choropleth-map" class="nav-link" data-scroll-target="#final-choropleth-map">Final choropleth map</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">01 Spatial Data Handline</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Teng Kok Wai (Walter) </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 5, 2024</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">September 7, 2024</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="exercise-reference" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="exercise-reference"><span class="header-section-number">1</span> Exercise Reference</h2>
<p><a href="https://spatialanalysis.github.io/lab_tutorials/1_R_Spatial_Data_Handling.html">Spatial Data Handling</a> by Luc Anselin and Grant Morrison</p>
</section>
<section id="introduction" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="introduction"><span class="header-section-number">2</span> Introduction</h2>
<p>In this lab, we will use the City of Chicago open data portal to download data on abandoned vehicles. Our end goal is to create a choropleth map with abandoned vehicles per capita for Chicago community areas. Before we can create the maps, we will need to download the information, select observations, aggregate data, join different files and carry out variable transformations in order to obtain a so-called “spatially intensive” variable for mapping (i.e., not just a count of abandoned vehicles, but a per capita ratio).</p>
</section>
<section id="learning-outcome" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="learning-outcome"><span class="header-section-number">3</span> Learning Outcome</h2>
<p>Learn how to carry out the following tasks:</p>
<ul>
<li><p>Download data from any Socrata-driven open data portal, such as the <a href="https://data.cityofchicago.org">City of Chicago open data portal</a></p></li>
<li><p>Filtering a data frame for specific entries</p></li>
<li><p>Selecting and renaming columns</p></li>
<li><p>Creating a simple features spatial object</p></li>
<li><p>Checking and adding/adjusting projection information</p></li>
<li><p>Dealing with missing data</p></li>
<li><p>Spatial join</p></li>
<li><p>Spatial aggregation</p></li>
<li><p>Parsing a pdf file</p></li>
<li><p>Merging data sets</p></li>
<li><p>Creating new variables</p></li>
<li><p>Basic choropleth mapping</p></li>
</ul>
</section>
<section id="r-packages-used" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="r-packages-used"><span class="header-section-number">4</span> R Packages Used</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 22%">
<col style="width: 77%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Package</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>RSocrata</strong></td>
<td>To read data directly from a Socrata powered open data portal, such as the Chicago open data portal.</td>
</tr>
<tr class="even">
<td><strong>tidyverse</strong> (includes <strong>dplyr</strong>)</td>
<td>To manipulate data frames, such as filtering data, selecting columns, and creating new variables.</td>
</tr>
<tr class="odd">
<td><strong>lubridate</strong></td>
<td>To select information out of the <em>date</em> format when filtering the data.</td>
</tr>
<tr class="even">
<td><strong>sf</strong></td>
<td>To create and manipulate simple features spatial objects, to read in the boundary file, and perform point in polygon on the data set to fill in missing community area information.</td>
</tr>
<tr class="odd">
<td><strong>pdftools</strong></td>
<td>To read and parse a PDF for Chicago community area population information.</td>
</tr>
<tr class="even">
<td><strong>tmap</strong></td>
<td>To make nice-looking choropleth maps.</td>
</tr>
</tbody>
</table>
<section id="r-commands-used" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="r-commands-used"><span class="header-section-number">4.1</span> R Commands Used</h3>
<p>Below follows a list of the commands used in this notebook. For further details and a comprehensive list of options, please consult the <a href="https://www.rdocumentation.org">R documentation</a>. Here is the information in a markdown table format:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 16%">
<col style="width: 83%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Package</strong></th>
<th><strong>Functions</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>base R</strong></td>
<td><code>setwd</code>, <code>install.packages</code>, <code>library</code>, <code>head</code>, <code>dim</code>, <code>class</code>, <code>as.Date</code>, <code>names</code>, <code>!is.na</code>, <code>is.numeric</code>, <code>as.integer</code>, <code>is.integer</code>, <code>length</code>, <code>strsplit</code>, <code>unlist</code>, <code>for</code>, <code>vector</code>, <code>substr</code>, <code>gsub</code>, <code>as.numeric</code>, <code>data.frame</code></td>
</tr>
<tr class="even">
<td><strong>RSocrata</strong></td>
<td><code>read.socrata</code></td>
</tr>
<tr class="odd">
<td><strong>tidyverse</strong></td>
<td><code>filter</code>, <code>%&gt;%</code> (pipe), <code>select</code> (with renaming), <code>count</code>, <code>rename</code>, <code>mutate</code></td>
</tr>
<tr class="even">
<td><strong>lubridate</strong></td>
<td><code>year</code>, <code>month</code></td>
</tr>
<tr class="odd">
<td><strong>sf</strong></td>
<td><code>st_as_sf</code>, <code>plot</code>, <code>st_crs</code>, <code>read_sf</code>, <code>st_transform</code>, <code>st_join</code>, <code>st_geometry</code>, <code>st_write</code></td>
</tr>
<tr class="even">
<td><strong>pdftools</strong></td>
<td><code>pdf_text</code></td>
</tr>
<tr class="odd">
<td><strong>tmap</strong></td>
<td><code>tm_shape</code>, <code>tm_polygons</code></td>
</tr>
</tbody>
</table>
<p>Import the required R packages mentioned above</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse, lubridate, sf, tmap, pdftools, RSocrata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="obtaining-data-from-the-chicago-open-data-portal" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="obtaining-data-from-the-chicago-open-data-portal"><span class="header-section-number">5</span> Obtaining data from the Chicago Open Data portal</h2>
<p>We will use the specialized <strong>RSocrata</strong> package to download the file with 311 calls about abandoned vehicles from the <a href="https://data.cityofchicago.org">City of Chicago open data portal</a>. A list of different types of 311 nuisance calls is given by selecting the button for <a href="https://data.cityofchicago.org/browse?category=Service%20Requests">Service Requests</a>. The abandoned vehicles data are contained in the entry for <a href="https://data.cityofchicago.org/Service-Requests/311-Service-Requests-Abandoned-Vehicles/3c9v-pnva">311 Service Requests - Abandoned Vehicles</a>.</p>
<p>To download the file, select the <strong>API</strong> button and copy the <strong>API Endpoint</strong> from the interface. This endpoint will be the target file URL. Instead of directly using the <code>read.socrata</code> function from the <strong>RSocrata</strong> package, we will first check if the file already exists in our local directory (<code>../data</code>). If it does not exist, we will download it from the City of Chicago open data portal and save it locally. If the file already exists, we will simply read it from the local directory, avoiding redundant downloads. ### Read using RSocrata</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>socrata.file <span class="ot">&lt;-</span> <span class="st">"https://data.cityofchicago.org/resource/suj7-cg3j.csv"</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>local.file <span class="ot">&lt;-</span> <span class="st">"../data/suj7-cg3j.csv"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(local.file)) {</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  vehicle.data <span class="ot">&lt;-</span> <span class="fu">read.socrata</span>(socrata.file)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(vehicle.data, local.file)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"Data downloaded and saved locally"</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  vehicle.data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(local.file)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"Data loaded from local"</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Data loaded from local"</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you try other ways to obtain this file, you may obtain a different variant of this data.</p>
<p>For example, if you try to download the csv file direct via the URL path, you may only obtain 1000 rows as there is a rate limit on the API.</p>
<p>If you download the csv file directly from the web portal, the CSV is truncated and may contain different/missing columns.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(vehicle.data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 261486     26</code></pre>
</div>
</div>
<p>The table has 261,486 observations on 26 variables.</p>
<p>In RStudio, the type of the variable in each column is listed under its name. For example, under <strong>creation_date</strong>, we see <strong>S3: POSIXct</strong>. You can also find out the same information by applying a <code>class</code> command to the variable <strong>vehicle.data$creation_date</strong>, as in</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(vehicle.data<span class="sc">$</span>creation_date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "POSIXct" "POSIXt" </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Alternatively, to load the data with the correct class from a CSV, use tidyverse’s <code>read_csv</code> instead of base R’s <code>read.csv</code>. Without the correct data class, you may have to perform manual conversion before you can join data frame in downstream tasks.</p>
</div>
</div>
<section id="extracting-observations-for-the-desired-time-period" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="extracting-observations-for-the-desired-time-period"><span class="header-section-number">5.1</span> Extracting observations for the desired time period</h3>
<p>To extract the observations for the selected year (2016) and month (9), we will use the <code>year</code> and <code>month</code> functions from the <strong>lubridate</strong> package. We will embed these expressions in a <code>filter</code> command (from <strong>tidyverse</strong>) to select the rows/observations that match the specified criterion. We will also use the pipe command <code>%&gt;%</code> to move the original data frame through the different filter stages and assign the end result to <strong>vehicle.sept16</strong>.</p>
<p>We again check the contents with a <code>head</code> command.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>vehicle.sept16 <span class="ot">&lt;-</span> vehicle.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">year</span>(creation_date) <span class="sc">==</span> <span class="dv">2016</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(<span class="fu">month</span>(creation_date) <span class="sc">==</span> <span class="dv">9</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(vehicle.sept16)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 26
  creation_date       status          completion_date     service_request_number
  &lt;dttm&gt;              &lt;chr&gt;           &lt;dttm&gt;              &lt;chr&gt;                 
1 2016-09-01 16:00:00 Completed - Dup 2016-09-01 16:00:00 16-06219980           
2 2016-09-01 16:00:00 Completed - Dup 2016-09-01 16:00:00 16-06220033           
3 2016-09-01 16:00:00 Completed - Dup 2016-09-01 16:00:00 16-06220056           
4 2016-09-01 16:00:00 Completed - Dup 2016-09-01 16:00:00 16-06220096           
5 2016-09-01 16:00:00 Completed - Dup 2016-09-01 16:00:00 16-06221253           
6 2016-09-01 16:00:00 Completed - Dup 2016-09-01 16:00:00 16-06225666           
# ℹ 22 more variables: type_of_service_request &lt;chr&gt;, license_plate &lt;chr&gt;,
#   vehicle_make_model &lt;chr&gt;, vehicle_color &lt;chr&gt;, current_activity &lt;chr&gt;,
#   most_recent_action &lt;chr&gt;,
#   how_many_days_has_the_vehicle_been_reported_as_parked_ &lt;dbl&gt;,
#   street_address &lt;chr&gt;, zip_code &lt;dbl&gt;, x_coordinate &lt;dbl&gt;,
#   y_coordinate &lt;dbl&gt;, ward &lt;dbl&gt;, police_district &lt;dbl&gt;,
#   community_area &lt;dbl&gt;, ssa &lt;dbl&gt;, latitude &lt;dbl&gt;, longitude &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>and the dimension:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(vehicle.sept16)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2555   26</code></pre>
</div>
</div>
<p>The filtered table now only has 2,637 observations.</p>
</section>
<section id="selecting-the-variables-for-the-final-table" class="level3" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="selecting-the-variables-for-the-final-table"><span class="header-section-number">5.2</span> Selecting the variables for the final table</h3>
<p>The current data frame contains 26 variables. Several of these are not really of interest to us, since we basically want the locations of the events. We will use the <code>select</code> command from <strong>tidyverse</strong> to pick out the columns that we want to keep. In addition, we will use the rename option in <code>select</code> to give new variable names. While this is not absolutely necessary at this stage (<strong>RSocrata</strong> has turned any <em>weird</em> variable names into proper R names), we may later want to save the data as a point shape file. The data associated with a shape file are store in a separate dBase file, and dBase only allows 10 characters for variable names.</p>
<p>So, in order to save ourselves some work later on, we will rename the selected variables to strings that do not exceed 10 characters.</p>
<p>First, we check the variable names using the <code>names</code> command.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(vehicle.sept16)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "creation_date"                                         
 [2] "status"                                                
 [3] "completion_date"                                       
 [4] "service_request_number"                                
 [5] "type_of_service_request"                               
 [6] "license_plate"                                         
 [7] "vehicle_make_model"                                    
 [8] "vehicle_color"                                         
 [9] "current_activity"                                      
[10] "most_recent_action"                                    
[11] "how_many_days_has_the_vehicle_been_reported_as_parked_"
[12] "street_address"                                        
[13] "zip_code"                                              
[14] "x_coordinate"                                          
[15] "y_coordinate"                                          
[16] "ward"                                                  
[17] "police_district"                                       
[18] "community_area"                                        
[19] "ssa"                                                   
[20] "latitude"                                              
[21] "longitude"                                             
[22] "location"                                              
[23] "location_address"                                      
[24] "location_city"                                         
[25] "location_state"                                        
[26] "location_zip"                                          </code></pre>
</div>
</div>
<p>To keep things simple, we will only keep <strong>community_area</strong>, <strong>latitude</strong> and <strong>longitude</strong>, and turn them into <strong>comm</strong>, <strong>lat</strong> and <strong>lon</strong>. The new data set is <strong>vehicles.final</strong>. Note that to rename a variable, the new name is listed first, on the left hand side of the equal sign, and the old name is on the right hand side. We check the result with the <code>head</code> command.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>vehicles.final <span class="ot">&lt;-</span> vehicle.sept16 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="at">comm =</span> community_area, </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">lat =</span> latitude, <span class="at">lon =</span> longitude)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(vehicles.final)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
   comm   lat   lon
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1    17  41.9 -87.8
2    20  41.9 -87.7
3    20  41.9 -87.7
4     1  42.0 -87.7
5    15  42.0 -87.7
6    70  41.7 -87.7</code></pre>
</div>
</div>
</section>
</section>
<section id="creating-a-point-layer" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="creating-a-point-layer"><span class="header-section-number">6</span> Creating a Point Layer</h2>
<p>So far, we have only dealt with a regular data frame, without taking advantage of any spatial features. However, the data frame contains fields with coordinates and R can turn these into an explicit spatial points layer that can be saved in a range of GIS formats. To accomplish this, we will use the (new) simple features or <strong>sf</strong> package functionality, which improves upon the older <strong>sp</strong>.</p>
<p>We will first use the <strong>lat</strong> and <strong>lon</strong> columns in the data frame to create a spatial points object. Note that <strong>lon</strong> is the x-coordinate and <strong>lat</strong> is the y-coordinate.</p>
<section id="creating-a-point-layer-from-coordinates-in-a-table---principle" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="creating-a-point-layer-from-coordinates-in-a-table---principle"><span class="header-section-number">6.1</span> Creating a point layer from coordinates in a table - principle</h3>
<p>In <strong>sf</strong>, a simple features object is constructed by combining a <em>geometry</em> with the actual data (in a data frame). However, this is simplified for <em>point objects</em> when the data frame contains the coordinates as variables. This is the case in our example, where we have latitude and longitude. We also have x and y, but since we are not sure what projection these coordinates correspond with, they are not useful at this stage.</p>
<p>The advantage of lat-lon is that they are decimal degrees, and thus unprojected. However, we can provide the information on the datum, typically WGS84 (the standard used in most applications for decimal degrees) by passing the coordinate reference system argument (<code>crs</code>) set to the <strong>EPSG</strong> code 4326. After that, we can use the built-in projection transformation functionality in <strong>sf</strong> to turn the points into any projection we want.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<section id="missing-coordinates" class="level4" data-number="6.1.1">
<h4 data-number="6.1.1" class="anchored" data-anchor-id="missing-coordinates"><span class="header-section-number">6.1.1</span> Missing coordinates</h4>
<p>In order to create a points layer, we need coordinates for every observation. However, as we can see from the <code>head</code> command above, there are (at least) two observations that do not have lat-lon information. Before we can proceed, we need to remove these from the data frame.</p>
<p>We again use a <code>filter</code> command, but now combine it with the <code>!is.na</code> expression, i.e., is not missing (na). We take a little short cut by assuming that if one of lat or lon is missing, the other one will be missing as well (although to keep it completely general, we would need to check each variable separately). We assign the result to the <strong>vehicle.coord</strong> data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>vehicle.coord <span class="ot">&lt;-</span> vehicles.final <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>(<span class="fu">is.na</span>(lat)))</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(vehicle.coord)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2553    3</code></pre>
</div>
</div>
<p>There are 2 records with missing coordinates, so we will omit them. The data records reduce from 2637 to 2635.</p>
</section>
</section>
<section id="creating-a-spatial-points-object" class="level3" data-number="6.2">
<h3 data-number="6.2" class="anchored" data-anchor-id="creating-a-spatial-points-object"><span class="header-section-number">6.2</span> Creating a spatial points object</h3>
<p>The <strong>sf</strong> package turns a non-spatial object like a data frame into a simple features spatial object by means of the <code>st_as_sf</code> function. This function can take a large number of arguments, but for now we will only use a few:</p>
<ul>
<li><p>the name of the data frame, i.e., vehicle.coord</p></li>
<li><p><code>coords</code>: the variable names for x and y (given in parentheses)</p></li>
<li><p><code>crs</code>: the coordinate reference system, here using the EPSG code of 4326</p></li>
<li><p><code>agr</code>: the so-called attibute-geometry-relationship which specifies how the attribute information (the data) relate to the geometry (the points); in our example, we will use “constant”</p></li>
</ul>
<p>In our example, we create <strong>vehicle.points</strong> and check its class.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>vehicle.points <span class="ot">=</span> <span class="fu">st_as_sf</span>(vehicle.coord, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>), <span class="at">crs =</span> <span class="dv">4326</span>, <span class="at">agr =</span> <span class="st">"constant"</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(vehicle.points)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sf"         "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
</div>
<p>Even though it is not that informative at this stage, we can also make a quick <code>plot</code>. Later, we will see how we can refine these plots using the <strong>tmap</strong> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(vehicle.points)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can also do a quick check of the projection information using the <code>st_crs</code> command.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(vehicle.points)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: EPSG:4326 
  wkt:
GEOGCRS["WGS 84",
    ENSEMBLE["World Geodetic System 1984 ensemble",
        MEMBER["World Geodetic System 1984 (Transit)"],
        MEMBER["World Geodetic System 1984 (G730)"],
        MEMBER["World Geodetic System 1984 (G873)"],
        MEMBER["World Geodetic System 1984 (G1150)"],
        MEMBER["World Geodetic System 1984 (G1674)"],
        MEMBER["World Geodetic System 1984 (G1762)"],
        MEMBER["World Geodetic System 1984 (G2139)"],
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]],
        ENSEMBLEACCURACY[2.0]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["geodetic latitude (Lat)",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["geodetic longitude (Lon)",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    USAGE[
        SCOPE["Horizontal component of 3D system."],
        AREA["World."],
        BBOX[-90,-180,90,180]],
    ID["EPSG",4326]]</code></pre>
</div>
</div>
</section>
</section>
<section id="abandoned-vehicles-by-community-area" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="abandoned-vehicles-by-community-area"><span class="header-section-number">7</span> Abandoned Vehicles by Community Area</h2>
<p>At this point, we will go about things in a slightly different way from how they are illustrated in the GeoDa workbook example. As it turns out, some of the points have missing community area information, which is a critical element to compute the number of abandoned cars at that scale. In GeoDa, we used a visual approach to obtain the missing information. Here, we will exploit some of the GIS functionality in <strong>sf</strong> to carry out a <strong>spatial join</strong>. This boils down to identifying which points belong to each community area (a so-called <em>point in polygon query</em>) and assigning the corresponding community area identifier to each point.</p>
<p>We proceed in three steps. First, we create a simple features spatial polygon object with the boundaries of the community areas, which we download from the Chicago Open Data portal. Next, we carry out a spatial join between our points object and the polygon object to assign a community area code to each point. Finally, we compute the point count by community area.</p>
<section id="community-area-boundary-file" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="community-area-boundary-file">Community Area boundary file</h3>
<p>We resort to the City of Chicago open data portal for the boundary file of the community areas. From the opening screen, select the button for <a href="https://data.cityofchicago.org/browse?category=Facilities+%26+Geographic%20Boundaries">Facilities &amp; Geo Boundaries</a>. This yields a list of different boundary files for a range of geographic areal units. The one for the community areas is <a href="https://data.cityofchicago.org/Facilities-Geographic-Boundaries/Boundaries-Community-Areas-current-/cauq-8yn6">Boundaries - Community Areas (current)</a>. This brings up an overview map of the geography of the community areas of Chicago. Of course, we could simply select one of the export buttons to download the files, but we want to do this programmatically. As it turns out, <strong>sf</strong> can read a <strong>geojson</strong> formatted file directly from the web, and we will exploit that functionality.</p>
<p>First, we need the name for the file. We can check the Socrata API file name, but that contains a <strong>json</strong> file, and we want a specific <strong>geojson</strong> file. As it turns out, the latter is simply the same file name, but with the <strong>geojson</strong> file extension. We set our variable <strong>comm.file</strong> to this URL and then use <code>sf_read</code> to load the boundary information into <strong>chicago.comm</strong>. As before, we can do a quick check of the class using the <code>class</code> command.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>comm.file <span class="ot">&lt;-</span> <span class="st">"https://data.cityofchicago.org/resource/igwz-8jzy.geojson"</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>comm.local <span class="ot">&lt;-</span> <span class="st">"../data/igwz-8jzy.geojson"</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(comm.local)) {</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">download.file</span>(comm.file, comm.local, <span class="at">method =</span> <span class="st">"curl"</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"File downloaded and saved locally"</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"File exists locally. Reading locally"</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "File exists locally. Reading locally"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>chicago.comm <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(comm.local)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(chicago.comm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sf"         "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(chicago.comm<span class="sc">$</span>area_num_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
</div>
<p>In addition, we check the projection information using <code>st_crs</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(chicago.comm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: WGS 84 
  wkt:
GEOGCRS["WGS 84",
    DATUM["World Geodetic System 1984",
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["geodetic latitude (Lat)",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["geodetic longitude (Lon)",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    ID["EPSG",4326]]</code></pre>
</div>
</div>
<p>Again, the layer is unprojected in decimal degrees. Also, a quick <code>plot</code>. Note that, by default, <strong>sf</strong> draws a choropleth map for each variable included in the data frame. Since we won’t be using <strong>sf</strong> for mapping, we ignore that aspect for now.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(chicago.comm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We also use <code>head</code> to check on the types of the variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(chicago.comm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 9 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -87.7069 ymin: 41.79448 xmax: -87.58001 ymax: 41.99076
Geodetic CRS:  WGS 84
# A tibble: 6 × 10
  community  area  shape_area perimeter area_num_1 area_numbe comarea_id comarea
  &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;  
1 DOUGLAS    0     46004621.… 0         35         35         0          0      
2 OAKLAND    0     16913961.… 0         36         36         0          0      
3 FULLER PA… 0     19916704.… 0         37         37         0          0      
4 GRAND BOU… 0     48492503.… 0         38         38         0          0      
5 KENWOOD    0     29071741.… 0         39         39         0          0      
6 LINCOLN S… 0     71352328.… 0         4          4          0          0      
# ℹ 2 more variables: shape_len &lt;chr&gt;, geometry &lt;MULTIPOLYGON [°]&gt;</code></pre>
</div>
</div>
<section id="changing-projections" class="level4" data-number="7.0.1">
<h4 data-number="7.0.1" class="anchored" data-anchor-id="changing-projections"><span class="header-section-number">7.0.1</span> Changing projections</h4>
<p>Before moving on to the spatial join operation, we will convert both the community area boundaries and the vehicle points to the same projection, using the <code>st_transform</code> command. We assign the UTM (Universal Tranverse Mercator) zone 16N, which the the proper one for Chicago, with an EPSG code of 32616. After the projection transformation, we check the result using <code>st_crs</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>chicago.comm <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(chicago.comm,<span class="dv">32616</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(chicago.comm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: EPSG:32616 
  wkt:
PROJCRS["WGS 84 / UTM zone 16N",
    BASEGEOGCRS["WGS 84",
        ENSEMBLE["World Geodetic System 1984 ensemble",
            MEMBER["World Geodetic System 1984 (Transit)"],
            MEMBER["World Geodetic System 1984 (G730)"],
            MEMBER["World Geodetic System 1984 (G873)"],
            MEMBER["World Geodetic System 1984 (G1150)"],
            MEMBER["World Geodetic System 1984 (G1674)"],
            MEMBER["World Geodetic System 1984 (G1762)"],
            MEMBER["World Geodetic System 1984 (G2139)"],
            ELLIPSOID["WGS 84",6378137,298.257223563,
                LENGTHUNIT["metre",1]],
            ENSEMBLEACCURACY[2.0]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4326]],
    CONVERSION["UTM zone 16N",
        METHOD["Transverse Mercator",
            ID["EPSG",9807]],
        PARAMETER["Latitude of natural origin",0,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",-87,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",0.9996,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",500000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["(E)",east,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["(N)",north,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    USAGE[
        SCOPE["Engineering survey, topographic mapping."],
        AREA["Between 90°W and 84°W, northern hemisphere between equator and 84°N, onshore and offshore. Belize. Canada - Manitoba; Nunavut; Ontario. Costa Rica. Cuba. Ecuador - Galapagos. El Salvador. Guatemala. Honduras. Mexico. Nicaragua. United States (USA)."],
        BBOX[0,-90,84,-84]],
    ID["EPSG",32616]]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>vehicle.points <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(vehicle.points,<span class="dv">32616</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(vehicle.points)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: EPSG:32616 
  wkt:
PROJCRS["WGS 84 / UTM zone 16N",
    BASEGEOGCRS["WGS 84",
        ENSEMBLE["World Geodetic System 1984 ensemble",
            MEMBER["World Geodetic System 1984 (Transit)"],
            MEMBER["World Geodetic System 1984 (G730)"],
            MEMBER["World Geodetic System 1984 (G873)"],
            MEMBER["World Geodetic System 1984 (G1150)"],
            MEMBER["World Geodetic System 1984 (G1674)"],
            MEMBER["World Geodetic System 1984 (G1762)"],
            MEMBER["World Geodetic System 1984 (G2139)"],
            ELLIPSOID["WGS 84",6378137,298.257223563,
                LENGTHUNIT["metre",1]],
            ENSEMBLEACCURACY[2.0]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4326]],
    CONVERSION["UTM zone 16N",
        METHOD["Transverse Mercator",
            ID["EPSG",9807]],
        PARAMETER["Latitude of natural origin",0,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8801]],
        PARAMETER["Longitude of natural origin",-87,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8802]],
        PARAMETER["Scale factor at natural origin",0.9996,
            SCALEUNIT["unity",1],
            ID["EPSG",8805]],
        PARAMETER["False easting",500000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8806]],
        PARAMETER["False northing",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8807]]],
    CS[Cartesian,2],
        AXIS["(E)",east,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["(N)",north,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    USAGE[
        SCOPE["Engineering survey, topographic mapping."],
        AREA["Between 90°W and 84°W, northern hemisphere between equator and 84°N, onshore and offshore. Belize. Canada - Manitoba; Nunavut; Ontario. Costa Rica. Cuba. Ecuador - Galapagos. El Salvador. Guatemala. Honduras. Mexico. Nicaragua. United States (USA)."],
        BBOX[0,-90,84,-84]],
    ID["EPSG",32616]]</code></pre>
</div>
</div>
</section>
</section>
<section id="spatial-join" class="level3" data-number="7.1">
<h3 data-number="7.1" class="anchored" data-anchor-id="spatial-join"><span class="header-section-number">7.1</span> Spatial join</h3>
<p>In essence, the spatial join operation finds the polygon to which each point belongs. Several points belong to the same polygon, so this is a many-to-one join. Instead of joining all the features of the polygon layer, we specify just <strong>area_num_1</strong>, which is the community area indicator. The command is <code>st_join</code> to which we pass the point layer as the first sf object, and the polygon layer as the second sf object (with only one column designated). We assign the result to the new spatial object <strong>comm.pts</strong>. We check the contents of the new object using a <code>head</code> command.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>comm.pts <span class="ot">&lt;-</span> <span class="fu">st_join</span>(vehicle.points,chicago.comm[<span class="st">"area_num_1"</span>])</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(comm.pts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 2 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 432913.8 ymin: 4621705 xmax: 443548.5 ymax: 4651818
Projected CRS: WGS 84 / UTM zone 16N
# A tibble: 6 × 3
   comm           geometry area_num_1
  &lt;dbl&gt;        &lt;POINT [m]&gt; &lt;chr&gt;     
1    17 (432913.8 4642827) 17        
2    20 (438997.5 4641020) 20        
3    20 (438997.5 4641020) 20        
4     1 (443548.5 4651818) 1         
5    15 (438145.2 4645227) 15        
6    70 (440657.5 4621705) 70        </code></pre>
</div>
</div>
<p>As we can see, the community area in <strong>comm</strong> matches the entry in <strong>area_num_1</strong>. However, there is one more issue to deal with. Upon closer examination, we find that the <strong>area_num_1</strong> variable is not numeric using the <code>is.numeric</code> check.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.numeric</span>(comm.pts<span class="sc">$</span>area_num_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<p>So, we proceed to turn this variable into a numeric format using <code>as.integer</code> and then do a quick check by means of <code>is.integer</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>comm.pts<span class="sc">$</span>area_num_1 <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(comm.pts<span class="sc">$</span>area_num_1)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">is.integer</span>(comm.pts<span class="sc">$</span>area_num_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>The same problem occurs in the <strong>chicago.comm</strong> data set, which can cause trouble later on when we will join it with other data. Therefore, we turn it into an integer as well.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>chicago.comm<span class="sc">$</span>area_num_1 <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(chicago.comm<span class="sc">$</span>area_num_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="counts-by-community-area" class="level3" data-number="7.2">
<h3 data-number="7.2" class="anchored" data-anchor-id="counts-by-community-area"><span class="header-section-number">7.2</span> Counts by community area</h3>
<p>We now need to count the number of points in each polygon. We proceed in two steps. First, we illustrate how we can move back from the simple features spatial points object to a simple data frame by stripping the geometry column. This is accomplished by setting <code>st_geometry</code> to <strong>NULL</strong>. We check the class of the new object to make sure it is no longer a simple feature.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry</span>(comm.pts) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(comm.pts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
</div>
<p>We next take advantage of the <strong>tidyverse</strong> <code>count</code> function to create a new data frame with the identifier of the community area and the number of points contained in each community area.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>veh.cnts <span class="ot">&lt;-</span> comm.pts <span class="sc">%&gt;%</span> <span class="fu">count</span>(area_num_1)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(veh.cnts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  area_num_1     n
       &lt;int&gt; &lt;int&gt;
1          1    63
2          2    91
3          3    22
4          4    31
5          5    18
6          6    20</code></pre>
</div>
</div>
<p>The new data frame has two fields: the original identifier <strong>area_num_1</strong> and the count as <strong>n</strong>. We can change the variable names for the count to something more meaningful by means of the <strong>tidyverse</strong> <code>rename</code> command and turn it from <strong>n</strong> to <strong>AGG.COUNT</strong> (to use the same variable as in the GeoDa workbook). Similarly, we also shorten <strong>area_num_1</strong> to <strong>comm</strong>. Again, the new name is on the LHS of the equal sign and the old name on the RHS.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>veh.cnts <span class="ot">&lt;-</span> veh.cnts <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">comm =</span> area_num_1, <span class="at">AGG.COUNT =</span> n)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(veh.cnts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
   comm AGG.COUNT
  &lt;int&gt;     &lt;int&gt;
1     1        63
2     2        91
3     3        22
4     4        31
5     5        18
6     6        20</code></pre>
</div>
</div>
</section>
<section id="mapping-the-vehicle-counts" class="level3" data-number="7.3">
<h3 data-number="7.3" class="anchored" data-anchor-id="mapping-the-vehicle-counts"><span class="header-section-number">7.3</span> Mapping the vehicle counts</h3>
<p>At this point, we have a polygon layer with the community area boundaries and some identifiers (<strong>chicago.comm</strong>) and a data frame with the community identifier and the aggregate vehicle count (<strong>veh.cnts</strong>). In order to map the vehicle counts by community area, we need to <code>join</code> the two tables. We use the <code>left_join</code> command and use <strong>area_num_1</strong> as the key for the first table (the community area boundaries), and <strong>comm</strong> as the key for the second table (the vehicle counts). Since we assured that both variables are now integers, the join will work (if one were a character and the other integer, there would be an error message). Note how in the command below, the two keys can have different variable names (but they must have the same values), which is made explicit in the <code>by</code> statement.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>chicago.comm <span class="ot">&lt;-</span> <span class="fu">left_join</span>(chicago.comm,veh.cnts, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"area_num_1"</span> <span class="ot">=</span> <span class="st">"comm"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can double check that the vehicle counts were added using the <code>head</code> command.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(chicago.comm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 10 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 441440.4 ymin: 4627153 xmax: 451817.1 ymax: 4648971
Projected CRS: WGS 84 / UTM zone 16N
# A tibble: 6 × 11
  community  area  shape_area perimeter area_num_1 area_numbe comarea_id comarea
  &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;          &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;  
1 DOUGLAS    0     46004621.… 0                 35 35         0          0      
2 OAKLAND    0     16913961.… 0                 36 36         0          0      
3 FULLER PA… 0     19916704.… 0                 37 37         0          0      
4 GRAND BOU… 0     48492503.… 0                 38 38         0          0      
5 KENWOOD    0     29071741.… 0                 39 39         0          0      
6 LINCOLN S… 0     71352328.… 0                  4 4          0          0      
# ℹ 3 more variables: shape_len &lt;chr&gt;, geometry &lt;MULTIPOLYGON [m]&gt;,
#   AGG.COUNT &lt;int&gt;</code></pre>
</div>
</div>
<section id="basic-choropleth-map" class="level4" data-number="7.3.1">
<h4 data-number="7.3.1" class="anchored" data-anchor-id="basic-choropleth-map"><span class="header-section-number">7.3.1</span> Basic choropleth map</h4>
<p>As we saw earlier, we can construct rudimentary maps using the <code>plot</code> command in <strong>sf</strong>, but for further control, we will use the <strong>tmap</strong> package. This uses a logic similar to Wilkinson’s <em>grammar of graphics</em>, which is also the basis for the structure of the plot commands in the <strong>ggplot</strong> package.</p>
<p>We leave a detailed treatment of <strong>tmap</strong> for a future lab and just use the basic defaults in this example. The commands are layered and always start by specifying a layer using the <code>tm_shape</code> command. In our example, this is <strong>chicago.comm</strong>. Next (after the plus sign) follow one of more drawing commands that cover a wide range of geographic shapes. Here, we will just use <code>tm_polygons</code> and specify <strong>AGG.COUNT</strong> as the variable to determine the classification. We leave everything to the default and obtain a map that illustrates the spatial distribution of the abandoned vehicle counts by community area.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(chicago.comm) <span class="sc">+</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"AGG.COUNT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="community-area-population-data" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="community-area-population-data"><span class="header-section-number">8</span> Community Area Population Data</h2>
<p>The Chicago Community Area 2010 population is contained in a pdf file, available from the <a href="http://www.cityofchicago.org/city/en/depts/dcd/supp_info/community_area_2000and2010censuspopulationcomparisons.html">City of Chicago web site</a>.</p>
<p>This link is to a pdf file that contains a table with the neighborhood ID, the neighborhood name, the populations for 2010 and 2000, the difference between the two years and the percentage difference. The full path to the pdf file is https://www.cityofchicago.org/content/dam/city/depts/zlup/Zoning_Main_Page/Publications/Census_2010_Community_Area_Profiles/Census_2010_and_2000_CA_Populations.pdf</p>
<section id="extracting-a-pdf-file" class="level3" data-number="8.1">
<h3 data-number="8.1" class="anchored" data-anchor-id="extracting-a-pdf-file"><span class="header-section-number">8.1</span> Extracting a pdf file</h3>
<p>A pdf file is difficult to handle as a source of data, since it doesn’t contain tags like an html file. We will use the <strong>pdftools</strong> package that allows us to turn the contents of a pdf file into a list of long character strings.</p>
<p>The resulting data structure is somewhat complex and not necessarily easy to parse. However, in our case, the table has such a simple structure that we can extract the population values by doing some sleuthing on which columns contain those values. This will illustrate the power of the various parsing and text extraction functions available in R.</p>
<p>We use the <code>pdf_text</code> function from <strong>pdftools</strong> to turn the pdf file into a list of character strings, one for each page. We specify the URL of the file as the input source.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>pdf.file <span class="ot">&lt;-</span> <span class="st">"https://www.cityofchicago.org/content/dam/city/depts/zlup/Zoning_Main_Page/Publications/Census_2010_Community_Area_Profiles/Census_2010_and_2000_CA_Populations.pdf"</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>local.file <span class="ot">&lt;-</span> <span class="st">"../data/Census_2010_and_2000_CA_Populations.pdf"</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(local.file)) {</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">download.file</span>(pdf.file, local.file, <span class="at">method =</span> <span class="st">"curl"</span>)</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"PDF file downloaded and saved locally"</span>)</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"PDF file exists locally. Reading from local"</span>)</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "PDF file exists locally. Reading from local"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>pop.dat <span class="ot">&lt;-</span> <span class="fu">pdf_text</span>(local.file)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(pop.dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
</div>
<p>We check the length of the data object using the <code>length</code> command and find that indeed it has only two elements (one for each page).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(pop.dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
</div>
</section>
<section id="parsing-the-pdf-file" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="parsing-the-pdf-file">Parsing the pdf file</h3>
<p>The <strong>pop.dat</strong> object has two entries, one for each page. Each entry is a single string. So, when you check the length of each item, it may be surprising that its <strong>length</strong> is only 1. That is because the underlying structure is unknown, it is simply a collection of characters contained in the string. For example, the first element, <strong>pop.dat[[1]]</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(pop.dat[[<span class="dv">1</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<p>We will parse this file by first turning each element into a separate list and then extracting the parts we are interested in.</p>
<p>First, to illustrate in detail what is going on, we will go through each step one by one, but then, in order to reach some level of efficiency, we turn it into a loop over the two elements, <code>for (i in 1:2)</code>.</p>
<p>We start by initializing a vector (<strong>nnlist</strong>) with an empty character, and confirm that it is indeed initialized.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>nnlist <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>nnlist</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] ""</code></pre>
</div>
</div>
<p>Next, we create a list of strings, one for each line in the table, by using the <code>strsplit</code> operation. This splits the long string into a list of one string for each line, by using the return character <strong>\n</strong> as the separator (the value for the <code>split</code> argument).</p>
<p>The resulting list, <strong>ppage</strong>, contains a list of 44 elements, matching the contents of the first page of the pdf file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>ppage <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(pop.dat[[<span class="dv">1</span>]],<span class="at">split=</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>ppage[[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "                              CITY OF CHICAGO"                                
 [2] "                            CENSUS 2010 AND 2000"                             
 [3] ""                                                                             
 [4] "                                                Population"                   
 [5] "Num        Community Area       2010        2,000     Difference   Percentage"
 [6] " 1    Rogers Park                54,991     63,484      -8,493       -13.4%"  
 [7] " 2    West Ridge                 71,942     73,199      -1,257        -1.7%"  
 [8] " 3    Uptown                     56,362     63,551      -7,189       -11.3%"  
 [9] " 4    Lincoln Square             39,493     44,574      -5,081       -11.4%"  
[10] " 5    North Center               31,867     31,895        -28         -0.1%"  
[11] " 6    Lake View                  94,368     94,817       -449         -0.5%"  
[12] " 7    Lincoln Park               64,116     64,320       -204         -0.3%"  
[13] " 8    Near North Side            80,484     72,811      7,673         10.5%"  
[14] " 9    Edison Park                11,187     11,259        -72         -0.6%"  
[15] " 10   Norwood Park               37,023     37,669       -646         -1.7%"  
[16] " 11   Jefferson Park             25,448     25,859       -411         -1.6%"  
[17] " 12   Forest Glen                18,508     18,165        343         1.9%"   
[18] " 13   North Park                 17,931     18,514       -583         -3.1%"  
[19] " 14   Albany Park                51,542     57,655      -6,113       -10.6%"  
[20] " 15   Portage Park               64,124     65,340      -1,216        -1.9%"  
[21] " 16   Irving Park                53,359     58,643      -5,284        -9.0%"  
[22] " 17   Dunning                    41,932     42,164       -232         -0.6%"  
[23] " 18   Montclare                  13,426     12,646        780         6.2%"   
[24] " 19   Belmont Cragin             78,743     78,144        599         0.8%"   
[25] " 20   Hermosa                    25,010     26,908      -1,898        -7.1%"  
[26] " 21   Avondale                   39,262     43,083      -3,821        -8.9%"  
[27] " 22   Logan Square               73,595     82,715      -9,120       -11.0%"  
[28] " 23   Humboldt Park              56,323     65,836      -9,513       -14.4%"  
[29] " 24   West Town                  81,432     87,435      -6,003        -6.9%"  
[30] " 25   Austin                     98,514    117,527     -19,013       -16.2%"  
[31] " 26   West Garfield Park         18,001     23,019      -5,018       -21.8%"  
[32] " 27   East Garfield Park         20,567     20,881       -314         -1.5%"  
[33] " 28   Near West Side             54,881     46,419      8,462         18.2%"  
[34] " 29   North Lawndale             35,912     41,768      -5,856       -14.0%"  
[35] " 30   South Lawndale             79,288     91,071     -11,783       -12.9%"  
[36] " 31   Lower West Side            35,769     44,031      -8,262       -18.8%"  
[37] " 32   Loop                       29,283     16,388      12,895        78.7%"  
[38] " 33   Near South Side            21,390     9,509       11,881       124.9%"  
[39] " 34   Armour Square              13,391     12,032      1,359         11.3%"  
[40] " 35   Douglas                    18,238     26,470      -8,232       -31.1%"  
[41] " 36   Oakland                     5,918     6,110        -192         -3.1%"  
[42] " 37   Fuller Park                 2,876     3,420        -544        -15.9%"  
[43] " 38   Grand Boulevard            21,929     28,006      -6,077       -21.7%"  
[44] " 39   Kenwood                    17,841     18,363       -522         -2.8%"  
[45] " 40   Washington Park            11,717     14,146      -2,429       -17.2%"  </code></pre>
</div>
</div>
<p>Each element is one long string, corresponding to a table row. We remove the first four lines (using the - operation on the list elements 1 through 4). These first rows appear on each page, so we are safe to repeat this procedure for the second page (string) as well.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>nni <span class="ot">&lt;-</span> ppage[[<span class="dv">1</span>]]</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>nni <span class="ot">&lt;-</span> nni[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)]</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>nni</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Num        Community Area       2010        2,000     Difference   Percentage"
 [2] " 1    Rogers Park                54,991     63,484      -8,493       -13.4%"  
 [3] " 2    West Ridge                 71,942     73,199      -1,257        -1.7%"  
 [4] " 3    Uptown                     56,362     63,551      -7,189       -11.3%"  
 [5] " 4    Lincoln Square             39,493     44,574      -5,081       -11.4%"  
 [6] " 5    North Center               31,867     31,895        -28         -0.1%"  
 [7] " 6    Lake View                  94,368     94,817       -449         -0.5%"  
 [8] " 7    Lincoln Park               64,116     64,320       -204         -0.3%"  
 [9] " 8    Near North Side            80,484     72,811      7,673         10.5%"  
[10] " 9    Edison Park                11,187     11,259        -72         -0.6%"  
[11] " 10   Norwood Park               37,023     37,669       -646         -1.7%"  
[12] " 11   Jefferson Park             25,448     25,859       -411         -1.6%"  
[13] " 12   Forest Glen                18,508     18,165        343         1.9%"   
[14] " 13   North Park                 17,931     18,514       -583         -3.1%"  
[15] " 14   Albany Park                51,542     57,655      -6,113       -10.6%"  
[16] " 15   Portage Park               64,124     65,340      -1,216        -1.9%"  
[17] " 16   Irving Park                53,359     58,643      -5,284        -9.0%"  
[18] " 17   Dunning                    41,932     42,164       -232         -0.6%"  
[19] " 18   Montclare                  13,426     12,646        780         6.2%"   
[20] " 19   Belmont Cragin             78,743     78,144        599         0.8%"   
[21] " 20   Hermosa                    25,010     26,908      -1,898        -7.1%"  
[22] " 21   Avondale                   39,262     43,083      -3,821        -8.9%"  
[23] " 22   Logan Square               73,595     82,715      -9,120       -11.0%"  
[24] " 23   Humboldt Park              56,323     65,836      -9,513       -14.4%"  
[25] " 24   West Town                  81,432     87,435      -6,003        -6.9%"  
[26] " 25   Austin                     98,514    117,527     -19,013       -16.2%"  
[27] " 26   West Garfield Park         18,001     23,019      -5,018       -21.8%"  
[28] " 27   East Garfield Park         20,567     20,881       -314         -1.5%"  
[29] " 28   Near West Side             54,881     46,419      8,462         18.2%"  
[30] " 29   North Lawndale             35,912     41,768      -5,856       -14.0%"  
[31] " 30   South Lawndale             79,288     91,071     -11,783       -12.9%"  
[32] " 31   Lower West Side            35,769     44,031      -8,262       -18.8%"  
[33] " 32   Loop                       29,283     16,388      12,895        78.7%"  
[34] " 33   Near South Side            21,390     9,509       11,881       124.9%"  
[35] " 34   Armour Square              13,391     12,032      1,359         11.3%"  
[36] " 35   Douglas                    18,238     26,470      -8,232       -31.1%"  
[37] " 36   Oakland                     5,918     6,110        -192         -3.1%"  
[38] " 37   Fuller Park                 2,876     3,420        -544        -15.9%"  
[39] " 38   Grand Boulevard            21,929     28,006      -6,077       -21.7%"  
[40] " 39   Kenwood                    17,841     18,363       -522         -2.8%"  
[41] " 40   Washington Park            11,717     14,146      -2,429       -17.2%"  </code></pre>
</div>
</div>
<p>To streamline the resulting data structure for further operations, we turn it into a simple vector by means of <code>unlist</code>. This then allows us to concatenate the result to the current <strong>nnlist</strong> vector (initially, this contains just a single element with an empty character, after the first step it contains the empty character and the first page).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>nnu <span class="ot">&lt;-</span> <span class="fu">unlist</span>(nni)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>nnlist <span class="ot">&lt;-</span> <span class="fu">c</span>(nnlist,nnu)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>nnlist</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] ""                                                                             
 [2] "Num        Community Area       2010        2,000     Difference   Percentage"
 [3] " 1    Rogers Park                54,991     63,484      -8,493       -13.4%"  
 [4] " 2    West Ridge                 71,942     73,199      -1,257        -1.7%"  
 [5] " 3    Uptown                     56,362     63,551      -7,189       -11.3%"  
 [6] " 4    Lincoln Square             39,493     44,574      -5,081       -11.4%"  
 [7] " 5    North Center               31,867     31,895        -28         -0.1%"  
 [8] " 6    Lake View                  94,368     94,817       -449         -0.5%"  
 [9] " 7    Lincoln Park               64,116     64,320       -204         -0.3%"  
[10] " 8    Near North Side            80,484     72,811      7,673         10.5%"  
[11] " 9    Edison Park                11,187     11,259        -72         -0.6%"  
[12] " 10   Norwood Park               37,023     37,669       -646         -1.7%"  
[13] " 11   Jefferson Park             25,448     25,859       -411         -1.6%"  
[14] " 12   Forest Glen                18,508     18,165        343         1.9%"   
[15] " 13   North Park                 17,931     18,514       -583         -3.1%"  
[16] " 14   Albany Park                51,542     57,655      -6,113       -10.6%"  
[17] " 15   Portage Park               64,124     65,340      -1,216        -1.9%"  
[18] " 16   Irving Park                53,359     58,643      -5,284        -9.0%"  
[19] " 17   Dunning                    41,932     42,164       -232         -0.6%"  
[20] " 18   Montclare                  13,426     12,646        780         6.2%"   
[21] " 19   Belmont Cragin             78,743     78,144        599         0.8%"   
[22] " 20   Hermosa                    25,010     26,908      -1,898        -7.1%"  
[23] " 21   Avondale                   39,262     43,083      -3,821        -8.9%"  
[24] " 22   Logan Square               73,595     82,715      -9,120       -11.0%"  
[25] " 23   Humboldt Park              56,323     65,836      -9,513       -14.4%"  
[26] " 24   West Town                  81,432     87,435      -6,003        -6.9%"  
[27] " 25   Austin                     98,514    117,527     -19,013       -16.2%"  
[28] " 26   West Garfield Park         18,001     23,019      -5,018       -21.8%"  
[29] " 27   East Garfield Park         20,567     20,881       -314         -1.5%"  
[30] " 28   Near West Side             54,881     46,419      8,462         18.2%"  
[31] " 29   North Lawndale             35,912     41,768      -5,856       -14.0%"  
[32] " 30   South Lawndale             79,288     91,071     -11,783       -12.9%"  
[33] " 31   Lower West Side            35,769     44,031      -8,262       -18.8%"  
[34] " 32   Loop                       29,283     16,388      12,895        78.7%"  
[35] " 33   Near South Side            21,390     9,509       11,881       124.9%"  
[36] " 34   Armour Square              13,391     12,032      1,359         11.3%"  
[37] " 35   Douglas                    18,238     26,470      -8,232       -31.1%"  
[38] " 36   Oakland                     5,918     6,110        -192         -3.1%"  
[39] " 37   Fuller Park                 2,876     3,420        -544        -15.9%"  
[40] " 38   Grand Boulevard            21,929     28,006      -6,077       -21.7%"  
[41] " 39   Kenwood                    17,841     18,363       -522         -2.8%"  
[42] " 40   Washington Park            11,717     14,146      -2,429       -17.2%"  </code></pre>
</div>
</div>
<p>We now repeat this operation for <strong>pop.dat[[2]]</strong>. More efficiently, we implement it as a loop, replacing <strong>i</strong> in turn by 1 and 2. This yields:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>nnlist <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) {</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  ppage <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(pop.dat[[i]],<span class="at">split=</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  nni <span class="ot">&lt;-</span> ppage[[<span class="dv">1</span>]]</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  nni <span class="ot">&lt;-</span> nni[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)]</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>  nnu <span class="ot">&lt;-</span> <span class="fu">unlist</span>(nni)</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>  nnlist <span class="ot">&lt;-</span> <span class="fu">c</span>(nnlist,nnu)</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>At the end of the loop, we check the contents of the vector <strong>nnlist</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>nnlist</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] ""                                                                                 
 [2] "Num        Community Area       2010        2,000     Difference   Percentage"    
 [3] " 1    Rogers Park                54,991     63,484      -8,493       -13.4%"      
 [4] " 2    West Ridge                 71,942     73,199      -1,257        -1.7%"      
 [5] " 3    Uptown                     56,362     63,551      -7,189       -11.3%"      
 [6] " 4    Lincoln Square             39,493     44,574      -5,081       -11.4%"      
 [7] " 5    North Center               31,867     31,895        -28         -0.1%"      
 [8] " 6    Lake View                  94,368     94,817       -449         -0.5%"      
 [9] " 7    Lincoln Park               64,116     64,320       -204         -0.3%"      
[10] " 8    Near North Side            80,484     72,811      7,673         10.5%"      
[11] " 9    Edison Park                11,187     11,259        -72         -0.6%"      
[12] " 10   Norwood Park               37,023     37,669       -646         -1.7%"      
[13] " 11   Jefferson Park             25,448     25,859       -411         -1.6%"      
[14] " 12   Forest Glen                18,508     18,165        343         1.9%"       
[15] " 13   North Park                 17,931     18,514       -583         -3.1%"      
[16] " 14   Albany Park                51,542     57,655      -6,113       -10.6%"      
[17] " 15   Portage Park               64,124     65,340      -1,216        -1.9%"      
[18] " 16   Irving Park                53,359     58,643      -5,284        -9.0%"      
[19] " 17   Dunning                    41,932     42,164       -232         -0.6%"      
[20] " 18   Montclare                  13,426     12,646        780         6.2%"       
[21] " 19   Belmont Cragin             78,743     78,144        599         0.8%"       
[22] " 20   Hermosa                    25,010     26,908      -1,898        -7.1%"      
[23] " 21   Avondale                   39,262     43,083      -3,821        -8.9%"      
[24] " 22   Logan Square               73,595     82,715      -9,120       -11.0%"      
[25] " 23   Humboldt Park              56,323     65,836      -9,513       -14.4%"      
[26] " 24   West Town                  81,432     87,435      -6,003        -6.9%"      
[27] " 25   Austin                     98,514    117,527     -19,013       -16.2%"      
[28] " 26   West Garfield Park         18,001     23,019      -5,018       -21.8%"      
[29] " 27   East Garfield Park         20,567     20,881       -314         -1.5%"      
[30] " 28   Near West Side             54,881     46,419      8,462         18.2%"      
[31] " 29   North Lawndale             35,912     41,768      -5,856       -14.0%"      
[32] " 30   South Lawndale             79,288     91,071     -11,783       -12.9%"      
[33] " 31   Lower West Side            35,769     44,031      -8,262       -18.8%"      
[34] " 32   Loop                       29,283     16,388      12,895        78.7%"      
[35] " 33   Near South Side            21,390     9,509       11,881       124.9%"      
[36] " 34   Armour Square              13,391     12,032      1,359         11.3%"      
[37] " 35   Douglas                    18,238     26,470      -8,232       -31.1%"      
[38] " 36   Oakland                     5,918     6,110        -192         -3.1%"      
[39] " 37   Fuller Park                 2,876     3,420        -544        -15.9%"      
[40] " 38   Grand Boulevard            21,929     28,006      -6,077       -21.7%"      
[41] " 39   Kenwood                    17,841     18,363       -522         -2.8%"      
[42] " 40   Washington Park            11,717     14,146      -2,429       -17.2%"      
[43] "Num       Community Area           2010         2,000     Difference   Percentage"
[44] " 41   Hyde Park                      25,681     29,920       -4,239      -14.2%"  
[45] " 42   Woodlawn                       25,983     27,086       -1,103       -4.1%"  
[46] " 43   South Shore                    49,767     61,556      -11,789      -19.2%"  
[47] " 44   Chatham                        31,028     37,275       -6,247      -16.8%"  
[48] " 45   Avalon Park                    10,185     11,147        -962        -8.6%"  
[49] " 46   South Chicago                  31,198     38,596       -7,398      -19.2%"  
[50] " 47   Burnside                        2,916     3,294         -378       -11.5%"  
[51] " 48   Calumet Heights                13,812     15,974       -2,162      -13.5%"  
[52] " 49   Roseland                       44,619     52,723       -8,104      -15.4%"  
[53] " 50   Pullman                         7,325     8,921        -1,596      -17.9%"  
[54] " 51   South Deering                  15,109     16,990       -1,881      -11.1%"  
[55] " 52   East Side                      23,042     23,653        -611        -2.6%"  
[56] " 53   West Pullman                   29,651     36,649       -6,998      -19.1%"  
[57] " 54   Riverdale                       6,482     9,809        -3,327      -33.9%"  
[58] " 55   Hegewisch                       9,426     9,781         -355        -3.6%"  
[59] " 56   Garfield Ridge                 34,513     36,101       -1,588       -4.4%"  
[60] " 57   Archer Heights                 13,393     12,644        749         5.9%"   
[61] " 58   Brighton Park                  45,368     44,912        456         1.0%"   
[62] " 59   McKinley Park                  15,612     15,962        -350        -2.2%"  
[63] " 60   Bridgeport                     31,977     33,694       -1,717       -5.1%"  
[64] " 61   New City                       44,377     51,721       -7,344      -14.2%"  
[65] " 62   West Elsdon                    18,109     15,921       2,188       13.7%"   
[66] " 63   Gage Park                      39,894     39,193        701         1.8%"   
[67] " 64   Clearing                       23,139     22,331        808         3.6%"   
[68] " 65   West Lawn                      33,355     29,235       4,120       14.1%"   
[69] " 66   Chicago Lawn                   55,628     61,412       -5,784       -9.4%"  
[70] " 67   West Englewood                 35,505     45,282       -9,777      -21.6%"  
[71] " 68   Englewood                      30,654     40,222       -9,568      -23.8%"  
[72] " 69   Greater Grand Crossing         32,602     38,619       -6,017      -15.6%"  
[73] " 70   Ashburn                        41,081     39,584       1,497        3.8%"   
[74] " 71   Auburn Gresham                 48,743     55,928       -7,185      -12.8%"  
[75] " 72   Beverly                        20,034     21,992       -1,958       -8.9%"  
[76] " 73   Washington Heights             26,493     29,843       -3,350      -11.2%"  
[77] " 74   Mount Greenwood                19,093     18,820        273         1.5%"   
[78] " 75   Morgan Park                    22,544     25,226       -2,682      -10.6%"  
[79] " 76   O'Hare                         12,756     11,956        800         6.7%"   
[80] " 77   Edgewater                      56,521     62,198       -5,677       -9.1%"  
[81] "      Total                       2,695,598   2,896,016    -200,418       -6.9%"  </code></pre>
</div>
</div>
<p>This is now a vector of 79 elements, each of which is a string. To clean things up, strip the first (empty) element, and the last element, which is nothing but the totals. We thus extract the elements from <strong>2</strong> to <strong>length - 1</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>nnlist <span class="ot">&lt;-</span> nnlist[<span class="dv">2</span><span class="sc">:</span>(<span class="fu">length</span>(nnlist)<span class="sc">-</span><span class="dv">1</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="extracting-the-population-values" class="level3" data-number="8.2">
<h3 data-number="8.2" class="anchored" data-anchor-id="extracting-the-population-values"><span class="header-section-number">8.2</span> Extracting the population values</h3>
<p>We first initialize a vector of zeros to hold the population values. It is the preferred approach to initialize a vector first if one knows its size, rather than having it grow by appending rows or columns. We use the <code>vector</code> command and specify the <code>mode="numeric"</code> and give the <code>length</code> as the length of the list.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>nnpop <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode=</span><span class="st">"numeric"</span>,<span class="at">length=</span><span class="fu">length</span>(nnlist))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We again will use a loop to process each element of the list (each line of the table) one by one. We use the <code>substr</code> command to extract the characters between position 27 and 39 (these values were determined after taking a careful look at the structure of the table). However, there is still a problem, since the population values contain commas. We now do two things in one line of code. First, we use <code>gsub</code> to substitute the comma character by an empty <strong>““</strong>. We turn the result into a numeric value by means of <code>as.numeric</code>. We then assign this number to position <strong>i</strong> of the vector. The resulting vector <strong>nnpop</strong> contains the population for each of the community areas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> (<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(nnlist))) {</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>     popchar <span class="ot">&lt;-</span> <span class="fu">substr</span>(nnlist[i],<span class="at">start=</span><span class="dv">27</span>,<span class="at">stop=</span><span class="dv">39</span>)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>     popval <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">","</span>,<span class="st">""</span>,popchar))</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>     nnpop[i] <span class="ot">&lt;-</span> popval</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>nnpop</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  2010 54991 71942 56362 39493 31867 94368 64116 80484 11187 37023 25448
[13] 18508 17931 51542 64124 53359 41932 13426 78743 25010 39262 73595 56323
[25] 81432 98514 18001 20567 54881 35912 79288 35769 29283 21390 13391 18238
[37]  5918  2876 21929 17841 11717  2010    25    25    49    31    10    31
[49]     2    13    44     7    15    23    29     6     9    34    13    45
[61]    15    31    44    18    39    23    33    55    35    30    NA    41
[73]    48    20    26    19    22    12    56</code></pre>
</div>
</div>
</section>
<section id="creating-a-data-frame-with-population-values" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="creating-a-data-frame-with-population-values">Creating a data frame with population values</h3>
<p>As a final step in the process of collecting the community area population information, we combine the vector with the population counts and a vector with community ID information into a data frame.</p>
<p>Since the community area indicators are simple sequence numbers, we create such a vector to serve as the ID, again using the length of the vector to determine the extent.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>nnid <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(nnlist))</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>nnid</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
[26] 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50
[51] 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75
[76] 76 77 78 79</code></pre>
</div>
</div>
<p>We turn the vectors <strong>nnid</strong> and <strong>nnpop</strong> into a data frame using the <code>data.frame</code> command. Since the variable names assigned automatically are not that informative, we next force them to <strong>NID</strong> and <strong>POP2010</strong> using the <code>names</code> command. Also, as we did before, we make sure the ID variable is an integer (for merging in GeoDa) by means of <code>as.integer</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>neighpop <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">as.integer</span>(nnid),nnpop)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(neighpop) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"NID"</span>,<span class="st">"POP2010"</span>)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(neighpop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  NID POP2010
1   1    2010
2   2   54991
3   3   71942
4   4   56362
5   5   39493
6   6   31867</code></pre>
</div>
</div>
</section>
</section>
<section id="mapping-community-area-abandoned-vehicles-per-capita" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="mapping-community-area-abandoned-vehicles-per-capita">Mapping Community Area Abandoned Vehicles Per Capita</h2>
<section id="computing-abandoned-vehicles-per-capita" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="computing-abandoned-vehicles-per-capita">Computing abandoned vehicles per capita</h3>
<p>Before proceeding further, we <code>left_join</code> the community population data to the community area layer, in the same way as we did for the vehicle counts.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>chicago.comm <span class="ot">&lt;-</span> <span class="fu">left_join</span>(chicago.comm,neighpop, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"area_num_1"</span> <span class="ot">=</span> <span class="st">"NID"</span>))</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(chicago.comm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 11 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 441440.4 ymin: 4627153 xmax: 451817.1 ymax: 4648971
Projected CRS: WGS 84 / UTM zone 16N
# A tibble: 6 × 12
  community  area  shape_area perimeter area_num_1 area_numbe comarea_id comarea
  &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;          &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;  
1 DOUGLAS    0     46004621.… 0                 35 35         0          0      
2 OAKLAND    0     16913961.… 0                 36 36         0          0      
3 FULLER PA… 0     19916704.… 0                 37 37         0          0      
4 GRAND BOU… 0     48492503.… 0                 38 38         0          0      
5 KENWOOD    0     29071741.… 0                 39 39         0          0      
6 LINCOLN S… 0     71352328.… 0                  4 4          0          0      
# ℹ 4 more variables: shape_len &lt;chr&gt;, geometry &lt;MULTIPOLYGON [m]&gt;,
#   AGG.COUNT &lt;int&gt;, POP2010 &lt;dbl&gt;</code></pre>
</div>
</div>
<p>We will now create a new variable using the <strong>tidyverse</strong> <code>mutate</code> command as the ratio of vehicle counts per 1000 population.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>chicago.comm <span class="ot">&lt;-</span> chicago.comm <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">vehpcap =</span> (AGG.COUNT <span class="sc">/</span> POP2010) <span class="sc">*</span> <span class="dv">1000</span>) </span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(chicago.comm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 12 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 441440.4 ymin: 4627153 xmax: 451817.1 ymax: 4648971
Projected CRS: WGS 84 / UTM zone 16N
# A tibble: 6 × 13
  community  area  shape_area perimeter area_num_1 area_numbe comarea_id comarea
  &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;          &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;  
1 DOUGLAS    0     46004621.… 0                 35 35         0          0      
2 OAKLAND    0     16913961.… 0                 36 36         0          0      
3 FULLER PA… 0     19916704.… 0                 37 37         0          0      
4 GRAND BOU… 0     48492503.… 0                 38 38         0          0      
5 KENWOOD    0     29071741.… 0                 39 39         0          0      
6 LINCOLN S… 0     71352328.… 0                  4 4          0          0      
# ℹ 5 more variables: shape_len &lt;chr&gt;, geometry &lt;MULTIPOLYGON [m]&gt;,
#   AGG.COUNT &lt;int&gt;, POP2010 &lt;dbl&gt;, vehpcap &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="final-choropleth-map" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="final-choropleth-map">Final choropleth map</h3>
<p>For our final choropleth, we use the same procedure as for the vehicle counts, but take <strong>vehpcap</strong> as the variable instead.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(chicago.comm) <span class="sc">+</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"vehpcap"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>When compared to the total counts, we see quite a different spatial distribution. In particular, the locations of the highest ratios are quite different from those of the highest counts. As a rule, one should <em>never</em> create a choropleth map of a spatially extensive variable, unless the size of the areal units is somehow controlled for (e.g., equal area grid cells, or equal population zones).</p>
<section id="optional---save-the-community-area-file-as-a-shape-file" class="level4" data-number="8.2.1">
<h4 data-number="8.2.1" class="anchored" data-anchor-id="optional---save-the-community-area-file-as-a-shape-file"><span class="header-section-number">8.2.1</span> Optional - save the community area file as a shape file</h4>
<p>Finally, we can write the community area layer to the working directory. Note that, so far, all operations have been carried out in memory, and when you close the program, everything will be lost (unless you save your workspace).</p>
<p>We can write the community area to a shape file (actually, four files contained in a directory) by means of the <strong>sf</strong> command <code>st_write</code>. This command has many options, but we just use the minimal ones. The <strong>chicago.comm</strong> object will be written to a set of files in the directory <strong>chicago_vehicles</strong> using the <strong>ESRI Shapefile</strong> format. Note that if the directory already exists, it should be deleted or renamed first, since <code>st_write</code> only creates a new directory. Otherwise, there will be an error message.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(chicago.comm,<span class="st">"chicago_vehicles"</span>,<span class="at">driver=</span><span class="st">"ESRI Shapefile"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Writing layer `chicago_vehicles' to data source 
  `chicago_vehicles' using driver `ESRI Shapefile'
Writing 77 features with 12 fields and geometry type Multi Polygon.</code></pre>
</div>
</div>
<p>However, this map can be highly misleading since it pertains to a so-called <em>spatially extensive</em> variable, such as a count. Even if every area had the same risk of having abandoned vehicles, larger community areas would have higher counts. In other words, since the count is directly related to the size of the area, it does not provide a proper indication of the risk.</p>
<p>Instead, we should map a <em>spatially intensive</em> variable, which is corrected for the size of the unit. For example, this can be achieved by expressing the variable as a density (counts per area), or as some other ratio, such as the counts per capita. In order to calculate this ratio, we first need to obtain the population for each community area.</p>


</section>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>A good resource on coordinate reference systems is the <a href="http://spatialreference.org">spatialreference.org</a> site, which contains thousands of references in a variety of commonly used formats.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = true;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/isss626-gaa\.netlify\.app\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>